<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Content Security Policy fÃ¶r sÃ¤kerhet -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: http:; script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' https: http: data:; media-src 'self' https: http: blob: data:; frame-src 'self' https: http:; connect-src 'self' https: http: ws: wss:;">
    <title>XOM TV â€“ Alla Iranska Kanaler (dec 2025)</title>
    <!-- HLS.js bibliotek fÃ¶r att spela m3u8 streams -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.10/dist/hls.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:Arial,sans-serif;
            background:#1a1a2e;
            color:white;
            display:flex;
            flex-direction:column;
            height:100vh;
            overflow:hidden;
        }
        .header{
            background:#16213e;
            padding:15px;
            text-align:center;
            border-bottom:4px solid #4ecdc4;
            position:relative;
            flex-shrink:0;
            display:flex;
            flex-direction:column;
            align-items:center;
        }
        .header-top {
            display:flex;
            align-items:center;
            justify-content:space-between;
            width:100%;
            position:relative;
            margin-bottom:8px;
        }
        .header h1{color:#4ecdc4;font-size:1.8em;margin:0;text-align:center;flex:1}
        .warning{color:#ffcc00;font-size:0.9em;margin-top:8px;text-align:center}
        
        /* Filter-knappar */
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            justify-content: center;
            width: 100%;
            max-width: 800px;
        }
        .filter-btn {
            background: #0f3460;
            color: white;
            border: 2px solid #4ecdc4;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 0.9em;
        }
        .filter-btn:hover {
            background: #4ecdc4;
            color: #012;
        }
        .filter-btn.active {
            background: #4ecdc4;
            color: #012;
            border-color: #4ecdc4;
        }
        
        .container{
            flex:1;
            display:flex;
            overflow:hidden;
        }
        .sidebar{
            width:340px;
            background:#0f3460;
            overflow-y:auto;
            padding:15px;
            flex-shrink:0;
        }
        .section{
            display: block;
        }
        .section.hidden {
            display: none !important;
        }
        .section h3{
            color:#4ecdc4;
            margin:25px 0 12px 0;
            font-size:1.2em;
            border-bottom:2px solid #4ecdc4;
            padding-bottom:6px;
            display: block;
        }
        .channel{
            background:#4ecdc4;
            color:#000;
            padding:10px 12px;
            margin:6px 0;
            border-radius:10px;
            cursor:pointer;
            font-weight:bold;
            transition:.18s;
            text-align:left;
            font-size:1em;
            display:flex;
            justify-content:space-between;
            align-items:center;
        }
        .channel:hover{background:#45b7aa;transform:scale(1.02)}
        .channel.active{background:#e74c3c;color:white}
        .channel .label{flex:1;padding-right:8px}
        
        /* Karwan-lÃ¤nk stil */
        .channel.karwan-link {
            background: #8e44ad;
            color: white;
        }
        .channel.karwan-link:hover {
            background: #9b59b6;
        }
        
        /* Extra lÃ¤nkar stil */
        .channel.extra-link {
            background: #2ecc71;
            color: white;
        }
        .channel.extra-link:hover {
            background: #27ae60;
        }
        .channel.extra-link.active {
            background: #e74c3c;
            color: white;
        }
        
        /* Web-lÃ¤nkar stil */
        .channel.web-link {
            background: #e67e22;
            color: white;
        }
        .channel.web-link:hover {
            background: #d35400;
        }
        
        .fav{
            background:transparent;
            border:none;
            font-size:1.1em;
            cursor:pointer;
            color:#012;
            padding:4px;
            line-height:1;
            min-width: 30px;
            min-height: 30px;
        }
        .fav.fav-active{color:#f5d259}
        .channel.active .fav{color:white}
        .channel.active .fav.fav-active{color:#f5d259}
        .player-area{
            flex:1;
            background:#000;
            display:flex;
            flex-direction:column;
            min-height:0;
            overflow:hidden;
        }
        .player-header{
            background:#16213e;
            padding:12px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            flex-shrink:0;
        }
        .player-header h2{
            color:#4ecdc4;
            font-size:1.5em;
            margin:0;
            flex:1;
            text-align:center;
        }
        .player-controls {
            display:flex;
            gap:10px;
            align-items:center;
        }
        .pip-btn {
            background: #4ecdc4;
            color: #012;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9em;
            white-space: nowrap;
            min-height: 44px;
            min-width: 44px;
        }
        .pip-btn:hover {
            background: #45b7aa;
        }
        
        /* Video element styling */
        #videoPlayer {
            flex: 1;
            width: 100%;
            min-height: 0;
            background: #000;
        }
        
        /* Iframe fÃ¶r telewebion streams */
        #iframePlayer {
            flex: 1;
            width: 100%;
            border: none;
            min-height: 0;
            background: #000;
            display: none;
        }
        
        .player-container {
            flex: 1;
            display: flex;
            flex-direction:column;
            min-height: 0;
            position: relative;
        }

        .menu-toggle{
            display:none;
            background:#4ecdc4;
            color:#012;
            border:none;
            padding:8px 12px;
            border-radius:6px;
            font-weight:bold;
            cursor:pointer;
            font-size:1em;
            z-index:1000;
            min-height: 44px;
        }

        /* Error overlay */
        .error-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 100;
            padding: 20px;
            text-align: center;
        }
        
        .error-overlay.active {
            display: flex;
        }
        
        .error-overlay button {
            background: #4ecdc4;
            color: #012;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin-top: 15px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Loading spinner */
        .loading-spinner {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 5px solid #4ecdc4;
            border-top: 5px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: 99;
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .loading-spinner.active {
            display: block;
        }

        /* Screen reader only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        @media(max-width:900px){
            .container{
                flex-direction:column;
                height:auto;
                min-height:0;
            }

            .player-area{
                flex:0 0 auto;
                height:70vh !important;
                min-height:300px;
                max-height:calc(100vh - 30vh);
            }

            .sidebar{
                width:100%;
                height:30vh !important;
                min-height:200px;
                max-height:calc(100vh - 70vh);
                overflow-y:auto;
                padding:10px;
                position:relative;
                display:none;
            }

            .header{
                padding:12px 10px;
            }
            
            .header-top {
                flex-direction:row;
                align-items:center;
                justify-content:space-between;
                margin-bottom:5px;
            }
            
            .menu-toggle{
                display:inline-block;
                order:-1;
                margin-right:10px;
                padding:6px 10px;
                font-size:0.9em;
            }
            
            .header h1{
                font-size:1.3em;
                margin:0;
                text-align:center;
                flex:1;
            }
            
            .warning{
                font-size:0.75em;
                margin-top:5px;
                line-height:1.2;
            }
            
            .filter-buttons {
                gap: 5px;
                margin-top: 8px;
            }
            .filter-btn {
                padding: 6px 12px;
                font-size: 0.8em;
                flex: 1;
                min-width: calc(25% - 5px);
                text-align: center;
                min-height: 44px;
            }

            .player-header{
                padding:10px;
                flex-wrap:wrap;
            }
            
            .player-header h2{
                font-size:1.2em;
                margin-bottom:5px;
                order:1;
                width:100%;
                text-align:center;
            }
            
            .player-controls{
                order:2;
                justify-content:center;
                width:100%;
                gap:15px;
            }
            
            .pip-btn {
                padding: 6px 10px;
                font-size: 0.85em;
                margin: 0;
            }

            .sidebar .section h3{
                display:block;
                margin:12px 0 6px 0;
                font-size:1.1em;
                padding-bottom:4px;
                position:sticky;
                top:0;
                background:#0f3460;
                z-index:10;
            }

            .channel{
                margin:4px 0;
                padding:12px 10px;
                border-radius:8px;
                font-size:0.95em;
                min-height: 44px;
            }
        }

        @media(max-width:480px){
            .player-area{
                height:75vh !important;
                min-height:280px;
            }

            .sidebar{
                height:25vh !important;
                min-height:180px;
            }

            .header h1{
                font-size:1.2em;
            }
            
            .menu-toggle{
                padding:5px 8px;
                font-size:0.8em;
            }
            
            .filter-buttons {
                flex-wrap: wrap;
            }
            .filter-btn {
                font-size: 0.75em;
                padding: 5px 8px;
                min-width: calc(50% - 5px);
            }
            
            .player-header h2{
                font-size:1.1em;
            }
            
            .pip-btn {
                padding: 5px 8px;
                font-size: 0.8em;
            }
            
            .channel{
                padding:12px 9px;
                font-size:0.9em;
            }
        }

        @media(max-width:900px) and (orientation: landscape){
            .player-area{
                height:80vh !important;
                min-height:250px;
            }
            .sidebar{
                height:20vh !important;
                min-height:150px;
            }
            
            .header h1{
                font-size:1.1em;
            }
            
            .warning{
                font-size:0.7em;
            }
            
            .filter-btn {
                font-size: 0.7em;
                padding: 4px 6px;
            }
            
            .player-header h2{
                font-size:1em;
            }
        }
        
        .mobile-header-info {
            display:none;
        }
        
        @media(max-width:900px){
            .mobile-header-info {
                display:block;
                font-size:0.75em;
                color:#4ecdc4;
                margin-top:3px;
                text-align:center;
                font-style:italic;
            }
        }
    </style>
</head>
<body>

<div class="header">
    <div class="header-top">
        <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Visa eller dÃ¶lj kanallista">
            ðŸ“º <span class="sr-only">Visa kanaler</span>
        </button>
        <h1>XOM TV</h1>
        <div style="width:80px"></div>
    </div>
    <p>Alla iranska TV-kanaler â€“ fungerar perfekt</p>
    <div class="filter-buttons">
        <button class="filter-btn active" onclick="filterChannels('all')">Alla kanaler</button>
        <button class="filter-btn" onclick="filterChannels('national')">1. Nationella</button>
        <button class="filter-btn" onclick="filterChannels('regional')">2. Regionala</button>
        <button class="filter-btn" onclick="filterChannels('kurdish')">3. Kurdiska</button>
        <button class="filter-btn" onclick="filterChannels('karwan')">4. Karwan TV</button>
        <button class="filter-btn" onclick="filterChannels('web')">5. Webbplatser</button>
    </div>
    <p class="warning">KÃ¶r via lokal server â†’ python -m http.server</p>
    <p class="mobile-header-info">Klicka pÃ¥ "Visa kanaler" fÃ¶r att vÃ¤lja kanal</p>
</div>

<div class="container">
    <div class="player-area">
        <div class="player-header">
            <h2 id="channelName">TV1</h2>
            <div class="player-controls">
                <button class="pip-btn" onclick="togglePictureInPicture(event)" aria-label="Aktivera bild-i-bild">ðŸ“º PiP</button>
                <button class="pip-btn" onclick="toggleFullscreen()" aria-label="Visa i fullskÃ¤rm">â›¶ FullskÃ¤rm</button>
                <button class="pip-btn" onclick="reloadPlayer()" aria-label="Ladda om spelaren">â†» Ladda om</button>
                <button class="pip-btn" onclick="toggleUserAgentMode()" aria-label="VÃ¤xla User-Agent lÃ¤ge" id="userAgentBtn">ðŸ“± UA: Auto</button>
            </div>
        </div>
        <div class="player-container">
            <div class="loading-spinner" id="loadingSpinner"></div>
            <div class="error-overlay" id="errorOverlay">
                <div id="errorMessage">Kunde inte ladda stream</div>
                <button onclick="retryCurrentStream()">FÃ¶rsÃ¶k igen</button>
                <button onclick="tryAlternativeStream()" style="margin-top: 10px; background: #e67e22;">Testa alternativ stream</button>
            </div>
            <video id="videoPlayer" controls playsinline>
                Din webblÃ¤sare stÃ¶der inte videoavspelning.
            </video>
            <iframe
                id="iframePlayer"
                src="https://m.telewebion.com/embed/live/tv1?autoplay=1&mute=0"
                allowfullscreen
                allow="autoplay *; encrypted-media *; picture-in-picture *; fullscreen *"
                loading="eager"
                sandbox="allow-scripts allow-same-origin allow-presentation allow-popups"
                title="TV-spelare"
                referrerpolicy="no-referrer-when-downgrade">
            </iframe>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="section" id="favSection">
            <h3>Favoriter</h3>
            <div id="favoritesList" style="color:#fff">Inga favoriter</div>
        </div>

        <div class="section" id="nationalSection">
            <h3>Nationella Kanaler</h3>
            <div class="channel active" onclick="load('tv1','TV1',this)">
                <span class="label">TV1</span>
                <button class="fav" onclick="toggleFav(event,'tv1','TV1',this)" aria-label="LÃ¤gg till favorit">â˜†</button>
            </div>
            <div class="channel" onclick="load('tv2','TV2',this)"><span class="label">TV2</span><button class="fav" onclick="toggleFav(event,'tv2','TV2',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('tv3','TV3',this)"><span class="label">TV3</span><button class="fav" onclick="toggleFav(event,'tv3','TV3',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('tv4','TV4',this)"><span class="label">TV4</span><button class="fav" onclick="toggleFav(event,'tv4','TV4',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('Tehran','Tehran',this)"><span class="label">Tehran</span><button class="fav" onclick="toggleFav(event,'Tehran','Tehran',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('nasim','NASIM',this)"><span class="label">NASIM</span><button class="fav" onclick="toggleFav(event,'nasim','NASIM',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('varzesh','VARZESH',this)"><span class="label">VARZESH (Sport)</span><button class="fav" onclick="toggleFav(event,'varzesh','VARZESH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('irinn','IRINN / KHABAR',this)"><span class="label">IRINN / KHABAR</span><button class="fav" onclick="toggleFav(event,'irinn','IRINN / KHABAR',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('irinn2','KHABAR2',this)"><span class="label">KHABAR2</span><button class="fav" onclick="toggleFav(event,'irinn2','KHABAR2',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('ifilm','IFILM Farsi',this)"><span class="label">IFILM Farsi</span><button class="fav" onclick="toggleFav(event,'ifilm','IFILM Farsi',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('ifilmdari_hls','IFILM Dari (HLS)', 'https://live.presstv.ir/hls/ifilm2.m3u8', this)"><span class="label">IFILM Dari (HLS)</span><button class="fav" onclick="toggleFav(event,'ifilmdari_hls','IFILM Dari (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('ifilmen_hls','IFILM English (HLS)', 'https://live.presstv.ir/hls/ifilmen.m3u8', this)"><span class="label">IFILM English (HLS)</span><button class="fav" onclick="toggleFav(event,'ifilmen_hls','IFILM English (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('ifilmar_hls','IFILM Arabic (HLS)', 'https://live.presstv.ir/hls/ifilmar.m3u8', this)"><span class="label">IFILM Arabic (HLS)</span><button class="fav" onclick="toggleFav(event,'ifilmar_hls','IFILM Arabic (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('tv1plus','TV1PLUS',this)"><span class="label">TV1PLUS</span><button class="fav" onclick="toggleFav(event,'tv1plus','TV1PLUS',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('omid','OMID',this)"><span class="label">OMID</span><button class="fav" onclick="toggleFav(event,'omid','OMID',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('namayesh','NAMAYESH',this)"><span class="label">NAMAYESH</span><button class="fav" onclick="toggleFav(event,'namayesh','NAMAYESH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('mostanad','MOSTANAD',this)"><span class="label">MOSTANAD</span><button class="fav" onclick="toggleFav(event,'mostanad','MOSTANAD',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('hdtest','TAMASHA',this)"><span class="label">TAMASHA</span><button class="fav" onclick="toggleFav(event,'hdtest','TAMASHA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('amouzesh','AMOOZESH',this)"><span class="label">AMOOZESH</span><button class="fav" onclick="toggleFav(event,'amouzesh','AMOOZESH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('salamat','SALAMAT',this)"><span class="label">SALAMAT</span><button class="fav" onclick="toggleFav(event,'salamat','SALAMAT',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('ofogh','OFOGH',this)"><span class="label">OFOGH</span><button class="fav" onclick="toggleFav(event,'ofogh','OFOGH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('quran','QURAN TV',this)"><span class="label">QURAN TV</span><button class="fav" onclick="toggleFav(event,'quran','QURAN TV',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('pooya','POOYA & JAVANAN',this)"><span class="label">POOYA & JAVANAN</span><button class="fav" onclick="toggleFav(event,'pooya','POOYA & JAVANAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('javaneh','JAVANEH / KOODAK+',this)"><span class="label">JAVANEH / KOODAK+</span><button class="fav" onclick="toggleFav(event,'javaneh','JAVANEH / KOODAK+',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sepehr','SEPEHR',this)"><span class="label">SEPEHR</span><button class="fav" onclick="toggleFav(event,'sepehr','SEPEHR',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('faratar','FARATAR',this)"><span class="label">FARATAR</span><button class="fav" onclick="toggleFav(event,'faratar','FARATAR',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('nava','NAVA',this)"><span class="label">NAVA</span><button class="fav" onclick="toggleFav(event,'nava','NAVA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('nama','NAMA',this)"><span class="label">NAMA</span><button class="fav" onclick="toggleFav(event,'nama','NAMA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('iribu','ROYA',this)"><span class="label">ROYA</span><button class="fav" onclick="toggleFav(event,'iribu','ROYA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('ara','ARA',this)"><span class="label">ARA</span><button class="fav" onclick="toggleFav(event,'ara','ARA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('iraneman','IRANEMAN',this)"><span class="label">IRANEMAN</span><button class="fav" onclick="toggleFav(event,'iraneman','IRANEMAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('golkhane','GOLKHANE',this)"><span class="label">GOLKHANE</span><button class="fav" onclick="toggleFav(event,'golkhane','GOLKHANE',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('negarestan','NEGARESTAN',this)"><span class="label">NEGARESTAN</span><button class="fav" onclick="toggleFav(event,'negarestan','NEGARESTAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('karoon','KAROON',this)"><span class="label">KAROON</span><button class="fav" onclick="toggleFav(event,'karoon','KAROON',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sport3','TELEWEBION',this)"><span class="label">TELEWEBION</span><button class="fav" onclick="toggleFav(event,'sport3','TELEWEBION',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sport1','TELEWEBION1',this)"><span class="label">TELEWEBION1</span><button class="fav" onclick="toggleFav(event,'sport1','TELEWEBION1',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sport3','TELEWEBION2',this)"><span class="label">TELEWEBION2</span><button class="fav" onclick="toggleFav(event,'sport3','TELEWEBION2',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('parseh','PARSEH',this)"><span class="label">PARSEH</span><button class="fav" onclick="toggleFav(event,'parseh','PARSEH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel"
