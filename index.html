<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: http:; script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' https: http: data:; media-src 'self' https: http: blob: data:; frame-src 'self' https: http:; connect-src 'self' https: http: ws: wss:;">
    <title>XOM TV â€“ Alla Iranska Kanaler (dec 2025)</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.10/dist/hls.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:Arial,sans-serif;
            background:#1a1a2e;
            color:white;
            display:flex;
            flex-direction:column;
            height:100vh;
            overflow:hidden;
        }
        .header{
            background:#16213e;
            padding:15px;
            text-align:center;
            border-bottom:4px solid #4ecdc4;
            position:relative;
            flex-shrink:0;
            display:flex;
            flex-direction:column;
            align-items:center;
        }
        .header-top {
            display:flex;
            align-items:center;
            justify-content:space-between;
            width:100%;
            position:relative;
            margin-bottom:8px;
        }
        .header h1{color:#4ecdc4;font-size:1.8em;margin:0;text-align:center;flex:1}
        .warning{color:#ffcc00;font-size:0.9em;margin-top:8px;text-align:center}
        
        /* Filter-knappar */
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            justify-content: center;
            width: 100%;
            max-width: 800px;
        }
        .filter-btn {
            background: #0f3460;
            color: white;
            border: 2px solid #4ecdc4;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 0.9em;
        }
        .filter-btn:hover {
            background: #4ecdc4;
            color: #012;
        }
        .filter-btn.active {
            background: #4ecdc4;
            color: #012;
            border-color: #4ecdc4;
        }
        
        .container{
            flex:1;
            display:flex;
            overflow:hidden;
        }
        .sidebar{
            width:340px;
            background:#0f3460;
            overflow-y:auto;
            padding:15px;
            flex-shrink:0;
        }
        .section{
            display: block;
        }
        .section.hidden {
            display: none !important;
        }
        .section h3{
            color:#4ecdc4;
            margin:25px 0 12px 0;
            font-size:1.2em;
            border-bottom:2px solid #4ecdc4;
            padding-bottom:6px;
            display: block;
        }
        .channel{
            background:#4ecdc4;
            color:#000;
            padding:10px 12px;
            margin:6px 0;
            border-radius:10px;
            cursor:pointer;
            font-weight:bold;
            transition:.18s;
            text-align:left;
            font-size:1em;
            display:flex;
            justify-content:space-between;
            align-items:center;
        }
        .channel:hover{background:#45b7aa;transform:scale(1.02)}
        .channel.active{background:#e74c3c;color:white}
        .channel .label{flex:1;padding-right:8px}
        
        /* Karwan-lÃ¤nk stil */
        .channel.karwan-link {
            background: #8e44ad;
            color: white;
        }
        .channel.karwan-link:hover {
            background: #9b59b6;
        }
        
        /* Extra lÃ¤nkar stil */
        .channel.extra-link {
            background: #2ecc71;
            color: white;
        }
        .channel.extra-link:hover {
            background: #27ae60;
        }
        .channel.extra-link.active {
            background: #e74c3c;
            color: white;
        }
        
        /* Web-lÃ¤nkar stil */
        .channel.web-link {
            background: #e67e22;
            color: white;
        }
        .channel.web-link:hover {
            background: #d35400;
        }
        
        .fav{
            background:transparent;
            border:none;
            font-size:1.1em;
            cursor:pointer;
            color:#012;
            padding:4px;
            line-height:1;
            min-width: 30px;
            min-height: 30px;
        }
        .fav.fav-active{color:#f5d259}
        .channel.active .fav{color:white}
        .channel.active .fav.fav-active{color:#f5d259}
        .channel.extra-link .fav{color:white}
        .channel.extra-link .fav.fav-active{color:#f5d259}
        .player-area{
            flex:1;
            background:#000;
            display:flex;
            flex-direction:column;
            min-height:0;
            overflow:hidden;
        }
        .player-header{
            background:#16213e;
            padding:12px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            flex-shrink:0;
        }
        .player-header h2{
            color:#4ecdc4;
            font-size:1.5em;
            margin:0;
            flex:1;
            text-align:center;
        }
        .player-controls {
            display:flex;
            gap:10px;
            align-items:center;
        }
        .pip-btn {
            background: #4ecdc4;
            color: #012;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9em;
            white-space: nowrap;
            min-height: 44px;
            min-width: 44px;
        }
        .pip-btn:hover {
            background: #45b7aa;
        }
        
        #videoPlayer {
            flex: 1;
            width: 100%;
            min-height: 0;
            background: #000;
        }
        
        #iframePlayer {
            flex: 1;
            width: 100%;
            border: none;
            min-height: 0;
            background: #000;
            display: none;
        }
        
        .player-container {
            flex: 1;
            display: flex;
            flex-direction:column;
            min-height: 0;
            position: relative;
        }

        .menu-toggle{
            display:none;
            background:#4ecdc4;
            color:#012;
            border:none;
            padding:8px 12px;
            border-radius:6px;
            font-weight:bold;
            cursor:pointer;
            font-size:1em;
            z-index:1000;
            min-height: 44px;
        }

        .error-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 100;
            padding: 20px;
            text-align: center;
        }
        
        .error-overlay.active {
            display: flex;
        }
        
        .error-overlay button {
            background: #4ecdc4;
            color: #012;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin-top: 15px;
            cursor: pointer;
            font-weight: bold;
        }

        .loading-spinner {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 5px solid #4ecdc4;
            border-top: 5px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: 99;
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .loading-spinner.active {
            display: block;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        @media(max-width:900px){
            .container{
                flex-direction:column;
                height:auto;
                min-height:0;
            }
            .player-area{
                flex:0 0 auto;
                height:70vh !important;
                min-height:300px;
                max-height:calc(100vh - 30vh);
            }
            .sidebar{
                width:100%;
                height:30vh !important;
                min-height:200px;
                max-height:calc(100vh - 70vh);
                overflow-y:auto;
                padding:10px;
                position:relative;
                display:none;
            }
            .header{
                padding:12px 10px;
            }
            .header-top {
                flex-direction:row;
                align-items:center;
                justify-content:space-between;
                margin-bottom:5px;
            }
            .menu-toggle{
                display:inline-block;
                order:-1;
                margin-right:10px;
                padding:6px 10px;
                font-size:0.9em;
            }
            .header h1{
                font-size:1.3em;
                margin:0;
                text-align:center;
                flex:1;
            }
            .warning{
                font-size:0.75em;
                margin-top:5px;
                line-height:1.2;
            }
            .filter-buttons {
                gap: 5px;
                margin-top: 8px;
            }
            .filter-btn {
                padding: 6px 12px;
                font-size: 0.8em;
                flex: 1;
                min-width: calc(25% - 5px);
                text-align: center;
                min-height: 44px;
            }
            .player-header{
                padding:10px;
                flex-wrap:wrap;
            }
            .player-header h2{
                font-size:1.2em;
                margin-bottom:5px;
                order:1;
                width:100%;
                text-align:center;
            }
            .player-controls{
                order:2;
                justify-content:center;
                width:100%;
                gap:15px;
            }
            .pip-btn {
                padding: 6px 10px;
                font-size: 0.85em;
                margin: 0;
            }
            .sidebar .section h3{
                display:block;
                margin:12px 0 6px 0;
                font-size:1.1em;
                padding-bottom:4px;
                position:sticky;
                top:0;
                background:#0f3460;
                z-index:10;
            }
            .channel{
                margin:4px 0;
                padding:12px 10px;
                border-radius:8px;
                font-size:0.95em;
                min-height: 44px;
            }
        }

        @media(max-width:480px){
            .player-area{
                height:75vh !important;
                min-height:280px;
            }
            .sidebar{
                height:25vh !important;
                min-height:180px;
            }
            .header h1{
                font-size:1.2em;
            }
            .menu-toggle{
                padding:5px 8px;
                font-size:0.8em;
            }
            .filter-buttons {
                flex-wrap: wrap;
            }
            .filter-btn {
                font-size: 0.75em;
                padding: 5px 8px;
                min-width: calc(50% - 5px);
            }
            .player-header h2{
                font-size:1.1em;
            }
            .pip-btn {
                padding: 5px 8px;
                font-size: 0.8em;
            }
            .channel{
                padding:12px 9px;
                font-size:0.9em;
            }
        }

        @media(max-width:900px) and (orientation: landscape){
            .player-area{
                height:80vh !important;
                min-height:250px;
            }
            .sidebar{
                height:20vh !important;
                min-height:150px;
            }
            .header h1{
                font-size:1.1em;
            }
            .warning{
                font-size:0.7em;
            }
            .filter-btn {
                font-size: 0.7em;
                padding: 4px 6px;
            }
            .player-header h2{
                font-size:1em;
            }
        }
        
        .mobile-header-info {
            display:none;
        }
        
        @media(max-width:900px){
            .mobile-header-info {
                display:block;
                font-size:0.75em;
                color:#4ecdc4;
                margin-top:3px;
                text-align:center;
                font-style:italic;
            }
        }
    </style>
</head>
<body>

<div class="header">
    <div class="header-top">
        <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Visa eller dÃ¶lj kanallista">
            ðŸ“º <span class="sr-only">Visa kanaler</span>
        </button>
        <h1>XOM TV</h1>
        <div style="width:80px"></div>
    </div>
    <p>Alla iranska TV-kanaler â€“ fungerar perfekt</p>
    <div class="filter-buttons">
        <button class="filter-btn active" onclick="filterChannels('all')">Alla kanaler</button>
        <button class="filter-btn" onclick="filterChannels('national')">1. Nationella</button>
        <button class="filter-btn" onclick="filterChannels('regional')">2. Regionala</button>
        <button class="filter-btn" onclick="filterChannels('kurdish')">3. Kurdiska</button>
        <button class="filter-btn" onclick="filterChannels('karwan')">4. Karwan TV</button>
        <button class="filter-btn" onclick="filterChannels('web')">5. Webbplatser</button>
    </div>
    <p class="warning">KÃ¶r via lokal server â†’ python -m http.server</p>
    <p class="mobile-header-info">Klicka pÃ¥ "Visa kanaler" fÃ¶r att vÃ¤lja kanal</p>
</div>

<div class="container">
    <div class="player-area">
        <div class="player-header">
            <h2 id="channelName">TV1</h2>
            <div class="player-controls">
                <button class="pip-btn" onclick="togglePictureInPicture(event)" aria-label="Aktivera bild-i-bild">ðŸ“º PiP</button>
                <button class="pip-btn" onclick="toggleFullscreen()" aria-label="Visa i fullskÃ¤rm">â›¶ FullskÃ¤rm</button>
                <button class="pip-btn" onclick="reloadPlayer()" aria-label="Ladda om spelaren">â†» Ladda om</button>
                <button class="pip-btn" onclick="toggleUserAgentMode()" aria-label="VÃ¤xla User-Agent lÃ¤ge" id="userAgentBtn">ðŸ“± UA: Auto</button>
            </div>
        </div>
        <div class="player-container">
            <div class="loading-spinner" id="loadingSpinner"></div>
            <div class="error-overlay" id="errorOverlay">
                <div id="errorMessage">Kunde inte ladda stream</div>
                <button onclick="retryCurrentStream()">FÃ¶rsÃ¶k igen</button>
                <button onclick="tryAlternativeStream()" style="margin-top: 10px; background: #e67e22;">Testa alternativ stream</button>
            </div>
            <video id="videoPlayer" controls playsinline>
                Din webblÃ¤sare stÃ¶der inte videoavspelning.
            </video>
            <iframe
                id="iframePlayer"
                src="https://m.telewebion.com/embed/live/tv1?autoplay=1&mute=0"
                allowfullscreen
                allow="autoplay *; encrypted-media *; picture-in-picture *; fullscreen *"
                loading="eager"
                sandbox="allow-scripts allow-same-origin allow-presentation allow-popups"
                title="TV-spelare"
                referrerpolicy="no-referrer-when-downgrade">
            </iframe>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="section" id="favSection">
            <h3>Favoriter</h3>
            <div id="favoritesList" style="color:#fff">Inga favoriter</div>
        </div>

        <div class="section" id="nationalSection">
            <h3>Nationella Kanaler</h3>
            <div class="channel active" onclick="load('tv1','TV1',this)">
                <span class="label">TV1</span>
                <button class="fav" onclick="toggleFav(event,'tv1','TV1',this)" aria-label="LÃ¤gg till favorit">â˜†</button>
            </div>
            <div class="channel" onclick="load('tv2','TV2',this)"><span class="label">TV2</span><button class="fav" onclick="toggleFav(event,'tv2','TV2',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('tv3','TV3',this)"><span class="label">TV3</span><button class="fav" onclick="toggleFav(event,'tv3','TV3',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('tv4','TV4',this)"><span class="label">TV4</span><button class="fav" onclick="toggleFav(event,'tv4','TV4',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('Tehran','Tehran',this)"><span class="label">Tehran</span><button class="fav" onclick="toggleFav(event,'Tehran','Tehran',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('nasim','NASIM',this)"><span class="label">NASIM</span><button class="fav" onclick="toggleFav(event,'nasim','NASIM',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('varzesh','VARZESH',this)"><span class="label">VARZESH (Sport)</span><button class="fav" onclick="toggleFav(event,'varzesh','VARZESH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('irinn','IRINN / KHABAR',this)"><span class="label">IRINN / KHABAR</span><button class="fav" onclick="toggleFav(event,'irinn','IRINN / KHABAR',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('irinn2','KHABAR2',this)"><span class="label">KHABAR2</span><button class="fav" onclick="toggleFav(event,'irinn2','KHABAR2',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('ifilm','IFILM Farsi',this)"><span class="label">IFILM Farsi</span><button class="fav" onclick="toggleFav(event,'ifilm','IFILM Farsi',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('ifilmdari_hls','IFILM Dari (HLS)', 'https://live.presstv.ir/hls/ifilm2.m3u8', this)"><span class="label">IFILM Dari (HLS)</span><button class="fav" onclick="toggleFav(event,'ifilmdari_hls','IFILM Dari (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('ifilmen_hls','IFILM English (HLS)', 'https://live.presstv.ir/hls/ifilmen.m3u8', this)"><span class="label">IFILM English (HLS)</span><button class="fav" onclick="toggleFav(event,'ifilmen_hls','IFILM English (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('ifilmar_hls','IFILM Arabic (HLS)', 'https://live.presstv.ir/hls/ifilmar.m3u8', this)"><span class="label">IFILM Arabic (HLS)</span><button class="fav" onclick="toggleFav(event,'ifilmar_hls','IFILM Arabic (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('tv1plus','TV1PLUS',this)"><span class="label">TV1PLUS</span><button class="fav" onclick="toggleFav(event,'tv1plus','TV1PLUS',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('omid','OMID',this)"><span class="label">OMID</span><button class="fav" onclick="toggleFav(event,'omid','OMID',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('namayesh','NAMAYESH',this)"><span class="label">NAMAYESH</span><button class="fav" onclick="toggleFav(event,'namayesh','NAMAYESH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('mostanad','MOSTANAD',this)"><span class="label">MOSTANAD</span><button class="fav" onclick="toggleFav(event,'mostanad','MOSTANAD',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('hdtest','TAMASHA',this)"><span class="label">TAMASHA</span><button class="fav" onclick="toggleFav(event,'hdtest','TAMASHA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('amouzesh','AMOOZESH',this)"><span class="label">AMOOZESH</span><button class="fav" onclick="toggleFav(event,'amouzesh','AMOOZESH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('salamat','SALAMAT',this)"><span class="label">SALAMAT</span><button class="fav" onclick="toggleFav(event,'salamat','SALAMAT',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('ofogh','OFOGH',this)"><span class="label">OFOGH</span><button class="fav" onclick="toggleFav(event,'ofogh','OFOGH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('quran','QURAN TV',this)"><span class="label">QURAN TV</span><button class="fav" onclick="toggleFav(event,'quran','QURAN TV',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('pooya','POOYA & JAVANAN',this)"><span class="label">POOYA & JAVANAN</span><button class="fav" onclick="toggleFav(event,'pooya','POOYA & JAVANAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('javaneh','JAVANEH / KOODAK+',this)"><span class="label">JAVANEH / KOODAK+</span><button class="fav" onclick="toggleFav(event,'javaneh','JAVANEH / KOODAK+',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sepehr','SEPEHR',this)"><span class="label">SEPEHR</span><button class="fav" onclick="toggleFav(event,'sepehr','SEPEHR',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('faratar','FARATAR',this)"><span class="label">FARATAR</span><button class="fav" onclick="toggleFav(event,'faratar','FARATAR',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('nava','NAVA',this)"><span class="label">NAVA</span><button class="fav" onclick="toggleFav(event,'nava','NAVA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('nama','NAMA',this)"><span class="label">NAMA</span><button class="fav" onclick="toggleFav(event,'nama','NAMA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('iribu','ROYA',this)"><span class="label">ROYA</span><button class="fav" onclick="toggleFav(event,'iribu','ROYA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('ara','ARA',this)"><span class="label">ARA</span><button class="fav" onclick="toggleFav(event,'ara','ARA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('iraneman','IRANEMAN',this)"><span class="label">IRANEMAN</span><button class="fav" onclick="toggleFav(event,'iraneman','IRANEMAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('golkhane','GOLKHANE',this)"><span class="label">GOLKHANE</span><button class="fav" onclick="toggleFav(event,'golkhane','GOLKHANE',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('negarestan','NEGARESTAN',this)"><span class="label">NEGARESTAN</span><button class="fav" onclick="toggleFav(event,'negarestan','NEGARESTAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('karoon','KAROON',this)"><span class="label">KAROON</span><button class="fav" onclick="toggleFav(event,'karoon','KAROON',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sport3','TELEWEBION',this)"><span class="label">TELEWEBION</span><button class="fav" onclick="toggleFav(event,'sport3','TELEWEBION',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sport1','TELEWEBION1',this)"><span class="label">TELEWEBION1</span><button class="fav" onclick="toggleFav(event,'sport1','TELEWEBION1',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sport3','TELEWEBION2',this)"><span class="label">TELEWEBION2</span><button class="fav" onclick="toggleFav(event,'sport3','TELEWEBION2',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('parseh','PARSEH',this)"><span class="label">PARSEH</span><button class="fav" onclick="toggleFav(event,'parseh','PARSEH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('nesfejahan','NESFEJAHAN',this)"><span class="label">NESFEJAHAN</span><button class="fav" onclick="toggleFav(event,'nesfejahan','NESFEJAHAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sarbedaran','SARBEDARAN',this)"><span class="label">SARBEDARAN</span><button class="fav" onclick="toggleFav(event,'sarbedaran','SARBEDARAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
        </div>

        <div class="section" id="regionalSection">
            <h3>Regionala Kanaler</h3>
            <div class="channel" onclick="load('mahabad','MAHABAD',this)"><span class="label">MAHABAD</span><button class="fav" onclick="toggleFav(event,'mahabad','MAHABAD',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('kordestan','KORDESTAN',this)"><span class="label">KORDESTAN</span><button class="fav" onclick="toggleFav(event,'kordestan','KORDESTAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('zagros','KERMANSHAH',this)"><span class="label">KERMANSHAH</span><button class="fav" onclick="toggleFav(event,'zagros','KERMANSHAH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('ilam','ILAM',this)"><span class="label">ILAM</span><button class="fav" onclick="toggleFav(event,'ilam','ILAM',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('bushehr','BOOSHEHR',this)"><span class="label">BOOSHEHR</span><button class="fav" onclick="toggleFav(event,'bushehr','BOOSHEHR',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('abadan','ABADAN',this)"><span class="label">ABADAN</span><button class="fav" onclick="toggleFav(event,'abadan','ABADAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('khalijefars','BANDARABBAS',this)"><span class="label">BANDARABBAS</span><button class="fav" onclick="toggleFav(event,'khalijefars','BANDARABBAS',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('khoozestan','AHVAZ',this)"><span class="label">AHVAZ</span><button class="fav" onclick="toggleFav(event,'khoozestan','AHVAZ',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('kish','KISH',this)"><span class="label">KISH</span><button class="fav" onclick="toggleFav(event,'kish','KISH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('hamoon','ZAHEDAN',this)"><span class="label">ZAHEDAN</span><button class="fav" onclick="toggleFav(event,'hamoon','ZAHEDAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('alborz','ALBORZ',this)"><span class="label">ALBORZ</span><button class="fav" onclick="toggleFav(event,'alborz','ALBORZ',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('aftab','ARAK',this)"><span class="label">ARAK</span><button class="fav" onclick="toggleFav(event,'aftab','ARAK',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('semnan','SEMNAN',this)"><span class="label">SEMNAN</span><button class="fav" onclick="toggleFav(event,'semnan','SEMNAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('noor','QOM',this)"><span class="label">QOM</span><button class="fav" onclick="toggleFav(event,'noor','QOM',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('qazvin','QAZVIN',this)"><span class="label">QAZVIN</span><button class="fav" onclick="toggleFav(event,'qazvin','QAZVIN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('jahanbin','4Mahalebakhtiari',this)"><span class="label">4Mahalebakhtiari</span><button class="fav" onclick="toggleFav(event,'jahanbin','4Mahalebakhtiari',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sina','HAMADAN',this)"><span class="label">HAMADAN</span><button class="fav" onclick="toggleFav(event,'sina','HAMADAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('aflak','LORESTAN',this)"><span class="label">LORESTAN</span><button class="fav" onclick="toggleFav(event,'aflak','LORESTAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('kerman','KERMAN',this)"><span class="label">KERMAN</span><button class="fav" onclick="toggleFav(event,'kerman','KERMAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('esfahan','ESFEHAN',this)"><span class="label">ESFEHAN</span><button class="fav" onclick="toggleFav(event,'esfahan','ESFEHAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('fars','FARS',this)"><span class="label">FARS</span><button class="fav" onclick="toggleFav(event,'fars','FARS',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('taban','YAZD',this)"><span class="label">YAZD</span><button class="fav" onclick="toggleFav(event,'taban','YAZD',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('dena','YASOOJ',this)"><span class="label">YASOOJ</span><button class="fav" onclick="toggleFav(event,'dena','YASOOJ',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('khavaran','KH.JONOBI',this)"><span class="label">KH.JONOBI</span><button class="fav" onclick="toggleFav(event,'khavaran','KH.JONOBI',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('atrak','KH.SHOMALI',this)"><span class="label">KH.SHOMALI</span><button class="fav" onclick="toggleFav(event,'atrak','KH.SHOMALI',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('khorasanrazavi','KH.RAZAVI',this)"><span class="label">KH.RAZAVI</span><button class="fav" onclick="toggleFav(event,'khorasanrazavi','KH.RAZAVI',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sabz','GORGAN',this)"><span class="label">GORGAN</span><button class="fav" onclick="toggleFav(event,'sabz','GORGAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('tabarestan','MAZANDARAN',this)"><span class="label">MAZANDARAN</span><button class="fav" onclick="toggleFav(event,'tabarestan','MAZANDARAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('baran','GILAN',this)"><span class="label">GILAN</span><button class="fav" onclick="toggleFav(event,'baran','GILAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sabalan','ARDABIL',this)"><span class="label">ARDABIL</span><button class="fav" onclick="toggleFav(event,'sabalan','ARDABIL',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sahand','TABRIZ',this)"><span class="label">TABRIZ</span><button class="fav" onclick="toggleFav(event,'sahand','TABRIZ',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('azarbayjangharbi','URMIA',this)"><span class="label">URMIA</span><button class="fav" onclick="toggleFav(event,'azarbayjangharbi','URMIA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('eshragh','ZANJAN',this)"><span class="label">ZANJAN</span><button class="fav" onclick="toggleFav(event,'eshragh','ZANJAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
        </div>

        <div class="section" id="kurdishSection">
            <h3>Kurdiska Kanaler</h3>
            <div class="channel extra-link" onclick="loadHLS('medmusic_hls','Med Music (HLS)', 'https://zindu.tv/intern-play.php?url=http://54.36.110.140/live3/live3.m3u8', this)">
                <span class="label">Med Music (HLS)</span>
                <button class="fav" onclick="toggleFav(event,'medmusic_hls','Med Music (HLS)',this)">â˜†</button>
            </div>
            <div class="channel extra-link" onclick="loadHLS('cira_hls','Cira TV (HLS)', 'https://vsd74.okcdn.ru/hls/9890583349861.m3u8/sig/URwADHA0Oyc/expires/1768168069508/srcIp/2.249.117.190/urls/185.226.53.83/clientType/0/srcAg/CHROME_MAC/mid/10267254464101/9890583349861_high/index.m3u8', this)">
                <span class="label">Cira TV (HLS)</span>
                <button class="fav" onclick="toggleFav(event,'cira_hls','Cira TV (HLS)',this)">â˜†</button>
            </div>
            <div class="channel extra-link" onclick="loadHLS('rojava_hls','Rojava TV (HLS)', 'https://hlspackager.akamaized.net/live/DB/ROJAVA_HD/HLS/ROJAVA_HD-mp4a_128000_eng=20000.m3u8', this)">
                <span class="label">Rojava TV (HLS)</span>
                <button class="fav" onclick="toggleFav(event,'rojava_hls','Rojava TV (HLS)',this)">â˜†</button>
            </div>
            <div class="channel extra-link" onclick="loadHLS('payam_hls','Payam TV (HLS)', 'https://media2.streambrothers.com:1936/8218/8218/chunklist_w377646187.m3u8', this)">
                <span class="label">Payam TV (HLS)</span>
                <button class="fav" onclick="toggleFav(event,'payam_hls','Payam TV (HLS)',this)">â˜†</button>
            </div>
            <div class="channel extra-link" onclick="loadHLS('trtkurdi_hls','TRT KurdÃ® (HLS)', 'https://tv-trtkurdi.medya.trt.com.tr/master_1440.m3u8', this)">
                <span class="label">TRT KurdÃ® (HLS)</span>
                <button class="fav" onclick="toggleFav(event,'trtkurdi_hls','TRT KurdÃ® (HLS)',this)">â˜†</button>
            </div>
            <div class="channel extra-link" onclick="loadHLS('zagros_hls','Zagros (HLS)', 'https://5a3ed7a72ed4b.streamlock.net/zagrostv/SMIL:myStream.smil/playlist.m3u8', this)"><span class="label">Zagros (HLS)</span><button class="fav" onclick="toggleFav(event,'zagros_hls','Zagros (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('kanal8_hls','Kanal8 (HLS)', 'https://live.channel8.com/Channel8-Kurdish/index.fmp4.m3u8', this)"><span class="label">Kanal8 (HLS)</span><button class="fav" onclick="toggleFav(event,'kanal8_hls','Kanal8 (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
        </div>

        <div class="section" id="karwanSection">
            <h3>Karwan TV LÃ¤nkar</h3>
            <div class="channel karwan-link" onclick="loadWeb('https://karwan.tv/tv1.html', 'TV1 (Karwan)', this)"><span class="label">TV1 (Karwan)</span><button class="fav" onclick="toggleFav(event,'karwan_tv1','TV1 (Karwan)',this, true)">â˜†</button></div>
        </div>
    </div>
</div>

<script>
    let hls;
    const video = document.getElementById('videoPlayer');
    const iframe = document.getElementById('iframePlayer');
    const channelNameDisplay = document.getElementById('channelName');
    
    // De nya HLS-strÃ¶mmarna fÃ¶r Favorites-systemet
    const hlsStreams = {
        'medmusic_hls': 'https://zindu.tv/intern-play.php?url=http://54.36.110.140/live3/live3.m3u8',
        'cira_hls': 'https://vsd74.okcdn.ru/hls/9890583349861.m3u8/sig/URwADHA0Oyc/expires/1768168069508/srcIp/2.249.117.190/urls/185.226.53.83/clientType/0/srcAg/CHROME_MAC/mid/10267254464101/9890583349861_high/index.m3u8',
        'rojava_hls': 'https://hlspackager.akamaized.net/live/DB/ROJAVA_HD/HLS/ROJAVA_HD-mp4a_128000_eng=20000.m3u8',
        'payam_hls': 'https://media2.streambrothers.com:1936/8218/8218/chunklist_w377646187.m3u8',
        'trtkurdi_hls': 'https://tv-trtkurdi.medya.trt.com.tr/master_1440.m3u8',
        'ifilmdari_hls': 'https://live.presstv.ir/hls/ifilm2.m3u8',
        'ifilmen_hls': 'https://live.presstv.ir/hls/ifilmen.m3u8',
        'ifilmar_hls': 'https://live.presstv.ir/hls/ifilmar.m3u8',
        'zagros_hls': 'https://5a3ed7a72ed4b.streamlock.net/zagrostv/SMIL:myStream.smil/playlist.m3u8',
        'kanal8_hls': 'https://live.channel8.com/Channel8-Kurdish/index.fmp4.m3u8'
    };

    const telewebionChannels = {
        'tv1': 'tv1', 'tv2': 'tv2', 'tv3': 'tv3', 'tv4': 'tv4', 'Tehran': 'tehran',
        'nasim': 'nasim', 'varzesh': 'varzesh', 'irinn': 'irinn', 'irinn2': 'khabar2',
        'ifilm': 'ifilm', 'tv1plus': 'tv1plus', 'omid': 'omid', 'namayesh': 'namayesh',
        'mostanad': 'mostanad', 'hdtest': 'hdtest', 'amouzesh': 'amouzesh',
        'salamat': 'salamat', 'ofogh': 'ofogh', 'quran': 'quran', 'pooya': 'pooya',
        'javaneh': 'javaneh', 'sepehr': 'sepehr', 'faratar': 'faratar', 'nava': 'nava',
        'nama': 'nama', 'iribu': 'iribu', 'ara': 'ara', 'iraneman': 'iraneman',
        'golkhane': 'golkhane', 'negarestan': 'negarestan', 'karoon': 'karoon',
        'sport3': 'sport3', 'sport1': 'sport1', 'parseh': 'parseh',
        'nesfejahan': 'nesfejahan', 'sarbedaran': 'sarbedaran', 'mahabad': 'mahabad',
        'kordestan': 'kordestan', 'zagros': 'zagros', 'ilam': 'ilam', 'bushehr': 'bushehr',
        'abadan': 'abadan', 'khalijefars': 'khalijefars', 'khoozestan': 'khoozestan',
        'kish': 'kish', 'hamoon': 'hamoon', 'alborz': 'alborz', 'aftab': 'aftab',
        'semnan': 'semnan', 'noor': 'noor', 'qazvin': 'qazvin', 'jahanbin': 'jahanbin',
        'sina': 'sina', 'aflak': 'aflak', 'kerman': 'kerman', 'esfahan': 'esfahan',
        'fars': 'fars', 'taban': 'taban', 'dena': 'dena', 'khavaran': 'khavaran',
        'atrak': 'atrak', 'khorasanrazavi': 'khorasanrazavi', 'sabz': 'sabz',
        'tabarestan': 'tabarestan', 'baran': 'baran', 'sabalan': 'sabalan',
        'sahand': 'sahand', 'azarbayjangharbi': 'azarbayjangharbi', 'eshragh': 'eshragh'
    };

    let currentChannel = 'tv1';
    let currentTitle = 'TV1';
    let currentChannelEl = null;
    let userAgentMode = 0; // 0: Auto, 1: Mobile (Android), 2: Desktop (Chrome)
    const modeNames = ["Auto", "Android", "Chrome"];

    function load(id, title, el) {
        currentChannel = id;
        currentTitle = title;
        currentChannelEl = el;
        
        document.querySelectorAll('.channel').forEach(c => c.classList.remove('active'));
        if(el) el.classList.add('active');
        
        channelNameDisplay.innerText = title;
        video.style.display = 'none';
        iframe.style.display = 'block';
        
        hideError();
        showLoading();
        
        const slug = telewebionChannels[id] || id;
        iframe.src = `https://m.telewebion.com/embed/live/${slug}?autoplay=1&mute=0`;
        
        iframe.onload = () => hideLoading();
    }

    function loadHLS(id, title, url, el) {
        currentTitle = title;
        currentChannelEl = el;
        
        document.querySelectorAll('.channel').forEach(c => c.classList.remove('active'));
        if(el) el.classList.add('active');
        
        channelNameDisplay.innerText = title;
        iframe.style.display = 'none';
        iframe.src = '';
        video.style.display = 'block';
        
        hideError();
        showLoading();
        
        if (hls) hls.destroy();

        if (Hls.isSupported()) {
            hls = new Hls({
                enableWorker: true,
                lowLatencyMode: true,
                backBufferLength: 60
            });
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                video.play();
                hideLoading();
            });
            hls.on(Hls.Events.ERROR, (event, data) => {
                if (data.fatal) {
                    showError(`Streamfel: ${data.type}`);
                    hideLoading();
                }
            });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.addEventListener('loadedmetadata', () => {
                video.play();
                hideLoading();
            });
        }
    }

    function loadWeb(url, title, el) {
        currentTitle = title;
        currentChannelEl = el;
        document.querySelectorAll('.channel').forEach(c => c.classList.remove('active'));
        if(el) el.classList.add('active');
        channelNameDisplay.innerText = title;
        video.style.display = 'none';
        iframe.style.display = 'block';
        hideError();
        iframe.src = url;
    }

    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.querySelector('.menu-toggle');
        if (sidebar.style.display === 'block') {
            sidebar.style.display = 'none';
            menuToggle.innerHTML = 'ðŸ“º <span class="sr-only">Visa kanaler</span>';
        } else {
            sidebar.style.display = 'block';
            menuToggle.innerHTML = 'âœ• <span class="sr-only">DÃ¶lj kanaler</span>';
        }
    }

    function filterChannels(category) {
        const sections = document.querySelectorAll('.section');
        const buttons = document.querySelectorAll('.filter-btn');
        
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        if (category === 'all') {
            sections.forEach(s => s.classList.remove('hidden'));
        } else {
            sections.forEach(s => {
                if (s.id === category + 'Section' || s.id === 'favSection') {
                    s.classList.remove('hidden');
                } else {
                    s.classList.add('hidden');
                }
            });
        }
    }

    function toggleFav(e, id, title, btn, isWeb = false) {
        e.stopPropagation();
        let favs = JSON.parse(localStorage.getItem('xomtv_favs') || '[]');
        const index = favs.findIndex(f => f.id === id);
        
        if (index > -1) {
            favs.splice(index, 1);
            btn.classList.remove('fav-active');
            btn.innerText = 'â˜†';
        } else {
            favs.push({ id, title, isWeb });
            btn.classList.add('fav-active');
            btn.innerText = 'â˜…';
        }
        
        localStorage.setItem('xomtv_favs', JSON.stringify(favs));
        renderFavorites();
    }

    function renderFavorites() {
        const list = document.getElementById('favoritesList');
        const favs = JSON.parse(localStorage.getItem('xomtv_favs') || '[]');
        
        // Uppdatera stjÃ¤rnor i huvudlistan
        document.querySelectorAll('.fav').forEach(btn => {
            const onclickAttr = btn.getAttribute('onclick');
            favs.forEach(f => {
                if (onclickAttr && onclickAttr.includes(`'${f.id}'`)) {
                    btn.classList.add('fav-active');
                    btn.innerText = 'â˜…';
                }
            });
        });

        if (favs.length === 0) {
            list.innerHTML = 'Inga favoriter';
            return;
        }

        list.innerHTML = '';
        favs.forEach(f => {
            const div = document.createElement('div');
            div.className = 'channel';
            if (f.id.includes('_hls')) div.className += ' extra-link';
            if (f.isWeb) div.className += ' web-link';
            
            div.onclick = () => {
                if (f.id.includes('_hls')) {
                    loadHLS(f.id, f.title, hlsStreams[f.id], div);
                } else if (f.isWeb) {
                    const originalBtn = document.querySelector(`.channel.karwan-link[onclick*="${f.id}"]`);
                    const url = originalBtn ? originalBtn.getAttribute('onclick').match(/'([^']+)'/g)[0].replace(/'/g, "") : "";
                    loadWeb(url, f.title, div);
                } else {
                    load(f.id, f.title, div);
                }
            };
            
            div.innerHTML = `<span class="label">${f.title}</span><button class="fav fav-active" onclick="toggleFav(event,'${f.id}','${f.title}',this, ${f.isWeb})">â˜…</button>`;
            list.appendChild(div);
        });
    }

    function showLoading() { document.getElementById('loadingSpinner').classList.add('active'); }
    function hideLoading() { document.getElementById('loadingSpinner').classList.remove('active'); }
    function showError(msg) { 
        const err = document.getElementById('errorOverlay');
        document.getElementById('errorMessage').innerText = msg;
        err.classList.add('active');
    }
    function hideError() { document.getElementById('errorOverlay').classList.remove('active'); }

    function reloadPlayer() {
        if (video.style.display === 'block') {
            const currentSrc = video.src || (hls && hls.url);
            if (currentSrc) loadHLS('', currentTitle, currentSrc, currentChannelEl);
        } else {
            const currentSrc = iframe.src;
            iframe.src = '';
            setTimeout(() => { iframe.src = currentSrc; }, 50);
        }
    }

    function toggleFullscreen() {
        const container = document.querySelector('.player-container');
        if (!document.fullscreenElement) {
            container.requestFullscreen().catch(err => console.log(err));
        } else {
            document.exitFullscreen();
        }
    }

    async function togglePictureInPicture(e) {
        e.stopPropagation();
        try {
            if (video.style.display === 'block') {
                if (video !== document.pictureInPictureElement) {
                    await video.requestPictureInPicture();
                } else {
                    await document.exitPictureInPicture();
                }
            } else {
                alert("PiP fungerar fÃ¶r nÃ¤rvarande endast fÃ¶r HLS-strÃ¶mmar (grÃ¶na knappar), inte fÃ¶r Telewebion/Karwan.");
            }
        } catch (error) {
            console.error(error);
        }
    }

    function toggleUserAgentMode() {
        userAgentMode = (userAgentMode + 1) % 3;
        const btn = document.getElementById('userAgentBtn');
        btn.textContent = `ðŸ“± UA: ${modeNames[userAgentMode]}`;
        
        if (telewebionChannels[currentChannel]) {
            load(currentChannel, currentTitle, currentChannelEl);
        }
    }

    function retryCurrentStream() {
        hideError();
        reloadPlayer();
    }

    function tryAlternativeStream() {
        hideError();
        reloadPlayer();
    }

    // Init
    window.onload = () => {
        renderFavorites();
        // Ladda TV1 som standard
        const firstChannel = document.querySelector('.channel');
        load('tv1', 'TV1', firstChannel);
    };

    // Auto-hide sidebar pÃ¥ mobil
    document.querySelectorAll('.channel').forEach(channel => {
        channel.addEventListener('click', function() {
            if (window.innerWidth <= 900) {
                const sidebar = document.getElementById('sidebar');
                sidebar.style.display = 'none';
                document.querySelector('.menu-toggle').innerHTML = 'ðŸ“º <span class="sr-only">Visa kanaler</span>';
            }
        });
    });
</script>

</body>
</html>
