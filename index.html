<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XOM TV - Alla iranska TV-kanaler</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #fff;
      min-height: 100vh;
    }

    .header {
      background: rgba(0,0,0,0.3);
      padding: 20px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      color: #4ecca3;
      margin-bottom: 10px;
    }

    .header p {
      opacity: 0.9;
    }

    .nav-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      padding: 15px;
    }

    .nav-btn {
      background: #4ecca3;
      color: #1e3c72;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }

    .nav-btn:hover, .nav-btn.active {
      background: #45b393;
      transform: scale(1.05);
    }

    .server-info {
      text-align: center;
      padding: 10px;
      color: #ffd700;
      font-size: 0.9em;
    }

    .container {
      display: flex;
      height: calc(100vh - 250px);
      padding: 0 20px 20px 20px;
      gap: 20px;
    }

    .channel-list {
      width: 280px;
      background: rgba(0,0,0,0.4);
      overflow-y: auto;
      border-radius: 10px;
      padding: 10px;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
        height: auto;
      }
      
      .channel-list {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        z-index: 1000;
        border-radius: 0;
        padding: 20px;
      }
      
      .channel-list.hidden {
        display: none;
      }
    }

    .video-container {
      flex: 1;
      background: #000;
      border-radius: 10px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .video-header {
      background: rgba(0,0,0,0.8);
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .video-title {
      font-size: 1.3em;
      color: #4ecca3;
    }

    .video-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      background: #4ecca3;
      color: #1e3c72;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: bold;
      transition: all 0.3s;
    }

    .btn:hover {
      background: #45b393;
    }

    .ua-selector {
      padding: 5px 0;
    }

    .ua-selector select {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid #4ecca3;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
    }

    .video-wrapper {
      flex: 1;
      position: relative;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    video, iframe {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border: none;
    }

    .error-message {
      text-align: center;
      padding: 40px;
    }

    .category-title {
      font-weight: bold;
      font-size: 1.1em;
      padding: 10px;
      color: #4ecca3;
      border-bottom: 2px solid #4ecca3;
      margin: 10px 0;
    }

    .channel-item {
      padding: 10px;
      margin: 5px 0;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
      font-size: 0.95em;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .channel-item.green {
      background: #28a745;
    }

    .channel-item.red {
      background: #dc3545;
    }

    .channel-item.orange {
      background: #fd7e14;
    }

    .channel-item.cyan {
      background: #17a2b8;
    }

    .channel-item.purple {
      background: #6f42c1;
    }

    .channel-item:hover {
      opacity: 0.8;
      transform: translateX(5px);
    }

    .channel-item.active {
      box-shadow: 0 0 15px rgba(78, 204, 163, 0.8);
      font-weight: bold;
    }

    .favorite-btn {
      background: none;
      border: none;
      color: #ffd700;
      cursor: pointer;
      font-size: 1.2em;
      padding: 0;
    }

    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.2);
    }

    ::-webkit-scrollbar-thumb {
      background: #4ecca3;
      border-radius: 4px;
    }

    .close-btn {
      display: none;
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1001;
      background: #dc3545;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 1.2em;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .close-btn {
        display: block;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>XOM TV</h1>
    <p>Alla iranska TV-kanaler ‚Äì fungerar perfekt</p>
  </div>

  <div class="nav-buttons">
    <button class="nav-btn" onclick="showAllChannels()">Alla kanaler</button>
    <button class="nav-btn" onclick="filterCategory('national')">1. Nationella</button>
    <button class="nav-btn" onclick="filterCategory('regional')">2. Regionala</button>
    <button class="nav-btn" onclick="filterCategory('kurdish')">3. Kurdiska</button>
    <button class="nav-btn" onclick="filterCategory('karwan')">4. Karwan TV</button>
    <button class="nav-btn" onclick="filterCategory('websites')">5. Webbplatser</button>
  </div>

  <div class="server-info">
    K√∂r via lokal server ‚Üí python -m http.server
  </div>

  <div class="container">
    <aside class="channel-list" id="channel-list">
      <button class="close-btn" onclick="toggleChannelList()">‚úï St√§ng</button>
      <div id="channels-container"></div>
    </aside>

    <main class="video-container">
      <div class="video-header">
        <div>
          <div class="video-title" id="current-channel">TV1</div>
          <div class="ua-selector">
            üì± UA: 
            <select id="ua-select" onchange="reloadStream()">
              <option value="">Auto</option>
              <option value="Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X)">iPhone</option>
              <option value="Mozilla/5.0 (iPad; CPU OS 14_0 like Mac OS X)">iPad</option>
              <option value="Mozilla/5.0 (Linux; Android 10)">Android</option>
            </select>
          </div>
        </div>
        <div class="video-controls">
          <button class="btn" onclick="toggleChannelList()">üì∫ Kanaler</button>
          <button class="btn" onclick="togglePiP()">üì∫ PiP</button>
          <button class="btn" onclick="toggleFullscreen()">‚õ∂ Fullsk√§rm</button>
          <button class="btn" onclick="reloadStream()">‚Üª Ladda om</button>
        </div>
      </div>

      <div class="video-wrapper" id="video-wrapper">
        <video id="video-player" controls></video>
      </div>
    </main>
  </div>

  <script>
    const channels = {
      national: [
        // Alla Telewebion-kanaler fr√•n den tredje filen
        { name: 'TV1', url: 'https://m.telewebion.com/embed/live/tv1?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'TV2', url: 'https://m.telewebion.com/embed/live/tv2?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'TV3', url: 'https://m.telewebion.com/embed/live/tv3?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'TV4', url: 'https://m.telewebion.com/embed/live/tv4?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'Tehran', url: 'https://m.telewebion.com/embed/live/Tehran?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'NASIM', url: 'https://m.telewebion.com/embed/live/nasim?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'VARZESH (Sport)', url: 'https://m.telewebion.com/embed/live/varzesh?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'IRINN / KHABAR', url: 'https://m.telewebion.com/embed/live/irinn?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'KHABAR2', url: 'https://m.telewebion.com/embed/live/irinn2?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'IFILM Farsi', url: 'https://m.telewebion.com/embed/live/ifilm?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'IFILM Farsi (Alt 2)', url: 'https://live.presstv.ir/hls/ifilmfa_4_482/index.m3u8', color: 'green' },
        { name: 'IFILM Dari (HLS)', url: 'https://live.presstv.ir/hls/ifilm2.m3u8', color: 'green' },
        { name: 'IFILM English (HLS)', url: 'https://live.presstv.ir/hls/ifilmen.m3u8', color: 'green' },
        { name: 'IFILM Arabic (HLS)', url: 'https://live.presstv.ir/hls/ifilmar.m3u8', color: 'green' },
        { name: 'TV1PLUS', url: 'https://m.telewebion.com/embed/live/tv1plus?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'OMID', url: 'https://m.telewebion.com/embed/live/omid?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'NAMAYESH', url: 'https://m.telewebion.com/embed/live/namayesh?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'MOSTANAD', url: 'https://m.telewebion.com/embed/live/mostanad?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'TAMASHA', url: 'https://m.telewebion.com/embed/live/hdtest?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'AMOOZESH', url: 'https://m.telewebion.com/embed/live/amouzesh?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'SALAMAT', url: 'https://m.telewebion.com/embed/live/salamat?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'OFOGH', url: 'https://m.telewebion.com/embed/live/ofogh?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'QURAN TV', url: 'https://m.telewebion.com/embed/live/quran?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'POOYA & JAVANAN', url: 'https://m.telewebion.com/embed/live/pooya?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'JAVANEH / KOODAK+', url: 'https://m.telewebion.com/embed/live/javaneh?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'SEPEHR', url: 'https://m.telewebion.com/embed/live/sepehr?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'FARATAR', url: 'https://m.telewebion.com/embed/live/faratar?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'NAVA', url: 'https://m.telewebion.com/embed/live/nava?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'NAMA', url: 'https://m.telewebion.com/embed/live/nama?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'ROYA', url: 'https://m.telewebion.com/embed/live/iribu?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'ARA', url: 'https://m.telewebion.com/embed/live/ara?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'IRANEMAN', url: 'https://m.telewebion.com/embed/live/iraneman?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'GOLKHANE', url: 'https://m.telewebion.com/embed/live/golkhane?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'NEGARESTAN', url: 'https://m.telewebion.com/embed/live/negarestan?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'KAROON', url: 'https://m.telewebion.com/embed/live/karoon?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'TELEWEBION', url: 'https://m.telewebion.com/embed/live/sport3?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'TELEWEBION1', url: 'https://m.telewebion.com/embed/live/sport1?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'TELEWEBION2', url: 'https://m.telewebion.com/embed/live/sport3?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'PARSEH', url: 'https://m.telewebion.com/embed/live/parseh?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'NESFEJAHAN', url: 'https://m.telewebion.com/embed/live/nesfejahan?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'SARBEDARAN', url: 'https://m.telewebion.com/embed/live/sarbedaran?autoplay=1&mute=0', color: 'cyan', method: 'iframe' }
      ],
      regional: [
        // Alla regionala kanaler fr√•n Telewebion
        { name: 'MAHABAD', url: 'https://m.telewebion.com/embed/live/mahabad?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'KORDESTAN', url: 'https://m.telewebion.com/embed/live/kordestan?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'KERMANSHAH', url: 'https://m.telewebion.com/embed/live/zagros?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'ILAM', url: 'https://m.telewebion.com/embed/live/ilam?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'BOOSHEHR', url: 'https://m.telewebion.com/embed/live/bushehr?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'ABADAN', url: 'https://m.telewebion.com/embed/live/abadan?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'BANDARABBAS', url: 'https://m.telewebion.com/embed/live/khalijefars?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'AHVAZ', url: 'https://m.telewebion.com/embed/live/khoozestan?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'KISH', url: 'https://m.telewebion.com/embed/live/kish?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'ZAHEDAN', url: 'https://m.telewebion.com/embed/live/hamoon?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'ALBORZ', url: 'https://m.telewebion.com/embed/live/alborz?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'ARAK', url: 'https://m.telewebion.com/embed/live/aftab?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'SEMNAN', url: 'https://m.telewebion.com/embed/live/semnan?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'QOM', url: 'https://m.telewebion.com/embed/live/noor?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'QAZVIN', url: 'https://m.telewebion.com/embed/live/qazvin?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: '4Mahalebakhtiari', url: 'https://m.telewebion.com/embed/live/jahanbin?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'HAMADAN', url: 'https://m.telewebion.com/embed/live/sina?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'LORESTAN', url: 'https://m.telewebion.com/embed/live/aflak?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'KERMAN', url: 'https://m.telewebion.com/embed/live/kerman?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'ESFEHAN', url: 'https://m.telewebion.com/embed/live/esfahan?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'FARS', url: 'https://m.telewebion.com/embed/live/fars?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'YAZD', url: 'https://m.telewebion.com/embed/live/taban?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'YASOOJ', url: 'https://m.telewebion.com/embed/live/dena?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'KH.JONOBI', url: 'https://m.telewebion.com/embed/live/khavaran?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'KH.SHOMALI', url: 'https://m.telewebion.com/embed/live/atrak?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'KH.RAZAVI', url: 'https://m.telewebion.com/embed/live/khorasanrazavi?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'GORGAN', url: 'https://m.telewebion.com/embed/live/sabz?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'MAZANDARAN', url: 'https://m.telewebion.com/embed/live/tabarestan?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'GILAN', url: 'https://m.telewebion.com/embed/live/baran?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'ARDABIL', url: 'https://m.telewebion.com/embed/live/sabalan?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'TABRIZ', url: 'https://m.telewebion.com/embed/live/sahand?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'URMIA', url: 'https://m.telewebion.com/embed/live/azarbayjangharbi?autoplay=1&mute=0', color: 'cyan', method: 'iframe' },
        { name: 'ZANJAN', url: 'https://m.telewebion.com/embed/live/eshragh?autoplay=1&mute=0', color: 'cyan', method: 'iframe' }
      ],
      kurdish: [
        { name: 'Zagros (HLS)', url: 'https://5a3ed7a72ed4b.streamlock.net/zagrostv/SMIL:myStream.smil/playlist.m3u8', color: 'green' },
        { name: 'Kanal8 (HLS)', url: 'https://live.channel8.com/Channel8-Kurdish/index.fmp4.m3u8', color: 'green' },
        { name: 'Rudaw (HLS)', url: 'https://svs.itworkscdn.net/rudawlive/rudawlive.smil/playlist.m3u8', color: 'green' },
        { name: 'Kurdsat News (HLS)', url: 'https://hlspackager.akamaized.net/live/DB/KURDSAT_NEWS/HLS/KURDSAT_NEWS.m3u8', color: 'green' },
        { name: 'Sterk (HLS)', url: 'https://5dab1db4b25fe.streamlock.net/sterk/sterktv/chunklist_w1084077249.m3u8', color: 'green' },
        { name: 'NRT News (HLS)', url: 'https://media.streambrothers.com:1936/8226/8226/playlist.m3u8', color: 'green' },
        { name: '4 Kurd (HLS)', url: 'https://4kuhls.persiana.live/hls/stream.m3u8', color: 'green' },
        { name: 'Med Music (HLS)', url: 'https://medmusic.cdn.asset.aparat.com/medmusic/index.m3u8', color: 'green' },
        { name: 'Aryen (HLS)', url: 'https://stream.aryen.tv/live/tv/chunklist_w189856026.m3u8', color: 'green' },
        { name: 'Cira (HLS)', url: 'https://live.ciratv.net/ciratv/index.m3u8', color: 'green' },
        { name: 'Waar (HLS)', url: 'https://live.kwikmotion.com/waarmedialive/waarmedia.smil/waarmediapublish/waarmedia_source/chunks.m3u8', color: 'green' },
        { name: 'Rojava (HLS)', url: 'https://live.rojavatv.net/rojavatv/index.m3u8', color: 'green' },
        { name: 'Kurdsat HD (HLS)', url: 'https://hlspackager.akamaized.net/live/DB/KURDSAT_HD/HLS/KURDSAT_HD.m3u8', color: 'green' },
        { name: 'Kurdistan TV (HLS)', url: 'https://5a3ed7a72ed4b.streamlock.net/live/SMIL:myStream.smil/playlist.m3u8', color: 'green' },
        { name: 'PDKI (HLS)', url: 'https://cdn.northtelecom.org/KurdChannel.m3u8', color: 'green' },
        { name: 'Komala (HLS)', url: 'https://live.tvkomala.com/live/komala/playlist.m3u8', color: 'green' },
        { name: 'GK (HLS)', url: 'https://live.host247.net/gk/gksat/playlist.m3u8', color: 'green' },
        { name: 'IRIB Kurdistan (HLS)', url: 'https://live.irib.ir/Channel-Live/smil:Channel5/playlist.m3u8', color: 'green' },
        { name: 'Ava TV (Web)', url: 'https://www.ava.news/livewatch', method: 'external', color: 'orange' },
        { name: 'Sahar TV (Web)', url: 'https://kurdish.sahartv.ir/live', method: 'external', color: 'orange' },
        { name: 'UTV Hawler (Web)', url: 'https://utvhawler.net/index.htm', method: 'external', color: 'orange' },
        { name: 'Baxche (HLS)', url: 'https://5dcabf026b188.streamlock.net/afarinTV/livestream/playlist.m3u8', color: 'green' },
        { name: 'Afarin Kids (HLS)', url: 'https://65f16f0fdfc51.streamlock.net/afarinTV/livestream/playlist.m3u8', color: 'green' },
        { name: 'Zarok Kurmanci (HLS)', url: 'https://zindikurmanci.zaroktv.com.tr/hls/0/stream.m3u8', color: 'green' },
        { name: 'Zarok Sorani (HLS)', url: 'https://zindisorani.zaroktv.com.tr/hls/stream.m3u8', color: 'green' },
        { name: 'Payam TV (HLS)', url: 'https://live.payamtv.com/payamtv/index.m3u8', color: 'green' },
        { name: 'TRT Kurd√Æ (HLS)', url: 'https://tv-trtkurdi.medya.trt.com.tr/master_1440.m3u8', color: 'green' }
      ],
      karwan: [
        { name: 'Karwan Mmn News', url: 'https://karwan.tv/mmn-news.html', method: 'external', color: 'purple' },
        { name: 'Karwan Shams TV', url: 'https://karwan.tv/shams-tv.html', method: 'external', color: 'purple' },
        { name: 'Karwan Rudaw TV', url: 'https://karwan.tv/rudaw-tv.html', method: 'external', color: 'purple' },
        { name: 'Karwan Channel 8', url: 'https://karwan.tv/channel-8.html', method: 'external', color: 'purple' },
        { name: 'Karwan CPI TV', url: 'https://karwan.tv/cpi-tv.html', method: 'external', color: 'purple' },
        { name: 'Karwan Duhok TV', url: 'https://karwan.tv/duhok-tv.html', method: 'external', color: 'purple' },
        { name: 'Karwan Geli Kurdistan TV', url: 'https://karwan.tv/geli-kurdistan-tv.html', method: 'external', color: 'purple' },
        { name: 'Karwan Kurdistan24 TV', url: 'https://karwan.tv/kurdistan24-tv.html', method: 'external', color: 'purple' },
        { name: 'Karwan Nalia TV', url: 'https://karwan.tv/nalia-tv.html', method: 'external', color: 'purple' },
        { name: 'Karwan Rojhelat TV', url: 'https://karwan.tv/rojhelat-tv.html', method: 'external', color: 'purple' },
        { name: 'Karwan Slemani TV', url: 'https://karwan.tv/slemani-tv.html', method: 'external', color: 'purple' },
        { name: 'Karwan Xabir TV', url: 'https://karwan.tv/xabir-tv.html', method: 'external', color: 'purple' },
        { name: 'Karwan Kurdistan TV', url: 'https://karwan.tv/kurdistan-tv.html', method: 'external', color: 'purple' }
      ],
      websites: [
        { name: 'Giniko TV', url: 'https://giniko.com/watch.php?id=iran', method: 'external', color: 'orange' },
        { name: 'Persianity', url: 'https://persianity.com', method: 'external', color: 'orange' },
        { name: 'Parsa TV', url: 'https://parsatv.com', method: 'external', color: 'orange' },
        { name: 'FarsiPlex', url: 'https://farsiplex.com', method: 'external', color: 'orange' },
        { name: 'Farsiland Movies', url: 'https://farsiland.com/movies', method: 'external', color: 'orange' },
        { name: 'Persian Hive', url: 'https://persianhive.com', method: 'external', color: 'orange' },
        { name: 'Namakade', url: 'https://namakade.com', method: 'external', color: 'orange' },
        { name: 'Telewebion', url: 'https://telewebion.com', method: 'external', color: 'orange' }
      ]
    };

    let hls;
    let currentChannel = { name: 'TV1', url: 'https://m.telewebion.com/embed/live/tv1?autoplay=1&mute=0', method: 'iframe' };
    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

    function renderChannels(filter = null) {
      const container = document.getElementById('channels-container');
      let html = '';

      Object.keys(channels).forEach(category => {
        if (filter && filter !== category) return;
        
        const categoryNames = {
          national: 'Nationella Kanaler',
          regional: 'Regionala Kanaler',
          kurdish: 'Kurdiska Kanaler',
          karwan: 'Karwan TV',
          websites: 'Webbplatser'
        };

        html += `<div class="category-title">${categoryNames[category]}</div>`;
        
        channels[category].forEach(ch => {
          const isFav = favorites.some(f => f.name === ch.name);
          html += `
            <div class="channel-item ${ch.color}" onclick="loadChannel('${ch.url}', '${ch.name}', '${ch.method || 'hls'}')">
              <span>${ch.name}</span>
              <button class="favorite-btn" onclick="event.stopPropagation(); toggleFavorite('${ch.name}', '${ch.url}', '${ch.method || 'hls'}')">
                ${isFav ? '‚≠ê' : '‚òÜ'}
              </button>
            </div>
          `;
        });
      });

      container.innerHTML = html;
      updateActiveChannel();
    }

    function updateActiveChannel() {
      document.querySelectorAll('.channel-item').forEach(item => {
        item.classList.remove('active');
        if (item.textContent.trim().startsWith(currentChannel.name)) {
          item.classList.add('active');
        }
      });
    }

    function toggleFavorite(name, url, method) {
      const index = favorites.findIndex(f => f.name === name);
      if (index > -1) {
        favorites.splice(index, 1);
      } else {
        favorites.push({ name, url, method });
      }
      localStorage.setItem('favorites', JSON.stringify(favorites));
      renderChannels();
    }

    function showAllChannels() {
      renderChannels();
    }

    function filterCategory(category) {
      renderChannels(category);
    }

    function toggleChannelList() {
      document.getElementById('channel-list').classList.toggle('hidden');
    }

    function loadChannel(url, name, method = 'hls') {
      if (window.innerWidth <= 768) {
        document.getElementById('channel-list').classList.add('hidden');
      }
      
      currentChannel = { name, url, method };
      document.getElementById('current-channel').textContent = name;
      
      const wrapper = document.getElementById('video-wrapper');
      
      if (hls) {
        hls.destroy();
        hls = null;
      }
      
      if (method === 'external') {
        window.open(url, '_blank');
        return;
      }
      
      if (method === 'iframe') {
        wrapper.innerHTML = `<iframe src="${url}" allowfullscreen allow="autoplay" style="width:100%;height:100%;border:none;"></iframe>`;
        updateActiveChannel();
        return;
      }

      wrapper.innerHTML = '<video id="video-player" controls crossorigin="anonymous"></video>';
      const video = document.getElementById('video-player');

      if (url.includes('.m3u8')) {
        if (Hls.isSupported()) {
          hls = new Hls({
            debug: false,
            enableWorker: true,
            lowLatencyMode: false,
            xhrSetup: function(xhr) {
              const ua = document.getElementById('ua-select').value;
              if (ua) xhr.setRequestHeader('User-Agent', ua);
            }
          });
          
          hls.on(Hls.Events.MANIFEST_PARSED, () => {
            video.play().catch(() => {});
          });
          
          hls.on(Hls.Events.ERROR, (event, data) => {
            if (data.fatal) {
              if (data.type === Hls.ErrorTypes.NETWORK_ERROR) {
                setTimeout(() => hls.startLoad(), 1000);
              } else if (data.type === Hls.ErrorTypes.MEDIA_ERROR) {
                hls.recoverMediaError();
              } else {
                showError();
              }
            }
          });
          
          hls.loadSource(url);
          hls.attachMedia(video);
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = url;
          video.play().catch(() => {});
        } else {
          showError();
        }
      } else {
        video.src = url;
        video.play().catch(() => {});
      }

      updateActiveChannel();
    }

    function showError() {
      document.getElementById('video-wrapper').innerHTML = `
        <div class="error-message">
          <h3>‚ö†Ô∏è Kunde inte ladda stream</h3>
          <button class="btn" onclick="reloadStream()">F√∂rs√∂k igen</button>
        </div>
      `;
    }

    function reloadStream() {
      loadChannel(currentChannel.url, currentChannel.name, currentChannel.method);
    }

    function togglePiP() {
      const video = document.getElementById('video-player');
      if (video && document.pictureInPictureEnabled) {
        if (document.pictureInPictureElement) {
          document.exitPictureInPicture();
        } else {
          video.requestPictureInPicture().catch(() => {});
        }
      }
    }

    function toggleFullscreen() {
      const wrapper = document.getElementById('video-wrapper');
      if (!document.fullscreenElement) {
        wrapper.requestFullscreen().catch(() => {});
      } else {
        document.exitFullscreen();
      }
    }

    // Initialize
    renderChannels();
    loadChannel(currentChannel.url, currentChannel.name, currentChannel.method);
  </script>
</body>
</html>
