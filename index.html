<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Content Security Policy fÃ¶r sÃ¤kerhet -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: http:; script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' https: http: data:; media-src 'self' https: http: blob: data:; frame-src 'self' https: http:; connect-src 'self' https: http: ws: wss:;">
    <title>XOM TV â€“ Alla Iranska Kanaler (dec 2025)</title>
    <!-- HLS.js bibliotek fÃ¶r att spela m3u8 streams -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.10/dist/hls.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:Arial,sans-serif;
            background:#1a1a2e;
            color:white;
            display:flex;
            flex-direction:column;
            height:100vh;
            overflow:hidden;
        }
        .header{
            background:#16213e;
            padding:15px;
            text-align:center;
            border-bottom:4px solid #4ecdc4;
            position:relative;
            flex-shrink:0;
            display:flex;
            flex-direction:column;
            align-items:center;
        }
        .header-top {
            display:flex;
            align-items:center;
            justify-content:space-between;
            width:100%;
            position:relative;
            margin-bottom:8px;
        }
        .header h1{color:#4ecdc4;font-size:1.8em;margin:0;text-align:center;flex:1}
        .warning{color:#ffcc00;font-size:0.9em;margin-top:8px;text-align:center}
        
        /* Filter-knappar */
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            justify-content: center;
            width: 100%;
            max-width: 800px;
        }
        .filter-btn {
            background: #0f3460;
            color: white;
            border: 2px solid #4ecdc4;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 0.9em;
        }
        .filter-btn:hover {
            background: #4ecdc4;
            color: #012;
        }
        .filter-btn.active {
            background: #4ecdc4;
            color: #012;
            border-color: #4ecdc4;
        }
        
        .container{
            flex:1;
            display:flex;
            overflow:hidden;
        }
        .sidebar{
            width:340px;
            background:#0f3460;
            overflow-y:auto;
            padding:15px;
            flex-shrink:0;
        }
        .section{
            display: block;
        }
        .section.hidden {
            display: none !important;
        }
        .section h3{
            color:#4ecdc4;
            margin:25px 0 12px 0;
            font-size:1.2em;
            border-bottom:2px solid #4ecdc4;
            padding-bottom:6px;
            display: block;
        }
        .channel{
            background:#4ecdc4;
            color:#000;
            padding:10px 12px;
            margin:6px 0;
            border-radius:10px;
            cursor:pointer;
            font-weight:bold;
            transition:.18s;
            text-align:left;
            font-size:1em;
            display:flex;
            justify-content:space-between;
            align-items:center;
        }
        .channel:hover{background:#45b7aa;transform:scale(1.02)}
        .channel.active{background:#e74c3c;color:white}
        .channel .label{flex:1;padding-right:8px}
        
        /* Karwan-lÃ¤nk stil */
        .channel.karwan-link {
            background: #8e44ad;
            color: white;
        }
        .channel.karwan-link:hover {
            background: #9b59b6;
        }
        
        /* Extra lÃ¤nkar stil */
        .channel.extra-link {
            background: #2ecc71;
            color: white;
        }
        .channel.extra-link:hover {
            background: #27ae60;
        }
        
        /* Web-lÃ¤nkar stil */
        .channel.web-link {
            background: #e67e22;
            color: white;
        }
        .channel.web-link:hover {
            background: #d35400;
        }
        
        .fav{
            background:transparent;
            border:none;
            font-size:1.1em;
            cursor:pointer;
            color:#012;
            padding:4px;
            line-height:1;
            min-width: 30px;
            min-height: 30px;
        }
        .fav.fav-active{color:#f5d259}
        .player-area{
            flex:1;
            background:#000;
            display:flex;
            flex-direction:column;
            min-height:0;
            overflow:hidden;
        }
        .player-header{
            background:#16213e;
            padding:12px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            flex-shrink:0;
        }
        .player-header h2{
            color:#4ecdc4;
            font-size:1.5em;
            margin:0;
            flex:1;
            text-align:center;
        }
        .player-controls {
            display:flex;
            gap:10px;
            align-items:center;
        }
        .pip-btn {
            background: #4ecdc4;
            color: #012;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9em;
            white-space: nowrap;
            min-height: 44px;
            min-width: 44px;
        }
        .pip-btn:hover {
            background: #45b7aa;
        }
        
        /* Video element styling */
        #videoPlayer {
            flex: 1;
            width: 100%;
            min-height: 0;
            background: #000;
        }
        
        /* Iframe fÃ¶r telewebion streams */
        #iframePlayer {
            flex: 1;
            width: 100%;
            border: none;
            min-height: 0;
            background: #000;
            display: none;
        }
        
        .player-container {
            flex: 1;
            display: flex;
            flex-direction:column;
            min-height: 0;
            position: relative;
        }

        .menu-toggle{
            display:none;
            background:#4ecdc4;
            color:#012;
            border:none;
            padding:8px 12px;
            border-radius:6px;
            font-weight:bold;
            cursor:pointer;
            font-size:1em;
            z-index:1000;
            min-height: 44px;
        }

        /* Error overlay */
        .error-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 100;
            padding: 20px;
            text-align: center;
        }
        
        .error-overlay.active {
            display: flex;
        }
        
        .error-overlay button {
            background: #4ecdc4;
            color: #012;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin-top: 15px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Loading spinner */
        .loading-spinner {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 5px solid #4ecdc4;
            border-top: 5px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: 99;
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .loading-spinner.active {
            display: block;
        }

        /* Screen reader only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        @media(max-width:900px){
            .container{
                flex-direction:column;
                height:auto;
                min-height:0;
            }

            .player-area{
                flex:0 0 auto;
                height:70vh !important;
                min-height:300px;
                max-height:calc(100vh - 30vh);
            }

            .sidebar{
                width:100%;
                height:30vh !important;
                min-height:200px;
                max-height:calc(100vh - 70vh);
                overflow-y:auto;
                padding:10px;
                position:relative;
                display:none;
            }

            .header{
                padding:12px 10px;
            }
            
            .header-top {
                flex-direction:row;
                align-items:center;
                justify-content:space-between;
                margin-bottom:5px;
            }
            
            .menu-toggle{
                display:inline-block;
                order:-1;
                margin-right:10px;
                padding:6px 10px;
                font-size:0.9em;
            }
            
            .header h1{
                font-size:1.3em;
                margin:0;
                text-align:center;
                flex:1;
            }
            
            .warning{
                font-size:0.75em;
                margin-top:5px;
                line-height:1.2;
            }
            
            .filter-buttons {
                gap: 5px;
                margin-top: 8px;
            }
            .filter-btn {
                padding: 6px 12px;
                font-size: 0.8em;
                flex: 1;
                min-width: calc(25% - 5px);
                text-align: center;
                min-height: 44px;
            }

            .player-header{
                padding:10px;
                flex-wrap:wrap;
            }
            
            .player-header h2{
                font-size:1.2em;
                margin-bottom:5px;
                order:1;
                width:100%;
                text-align:center;
            }
            
            .player-controls{
                order:2;
                justify-content:center;
                width:100%;
                gap:15px;
            }
            
            .pip-btn {
                padding: 6px 10px;
                font-size: 0.85em;
                margin: 0;
            }

            .sidebar .section h3{
                display:block;
                margin:12px 0 6px 0;
                font-size:1.1em;
                padding-bottom:4px;
                position:sticky;
                top:0;
                background:#0f3460;
                z-index:10;
            }

            .channel{
                margin:4px 0;
                padding:12px 10px;
                border-radius:8px;
                font-size:0.95em;
                min-height: 44px;
            }
        }

        @media(max-width:480px){
            .player-area{
                height:75vh !important;
                min-height:280px;
            }

            .sidebar{
                height:25vh !important;
                min-height:180px;
            }

            .header h1{
                font-size:1.2em;
            }
            
            .menu-toggle{
                padding:5px 8px;
                font-size:0.8em;
            }
            
            .filter-buttons {
                flex-wrap: wrap;
            }
            .filter-btn {
                font-size: 0.75em;
                padding: 5px 8px;
                min-width: calc(50% - 5px);
            }
            
            .player-header h2{
                font-size:1.1em;
            }
            
            .pip-btn {
                padding: 5px 8px;
                font-size: 0.8em;
            }
            
            .channel{
                padding:12px 9px;
                font-size:0.9em;
            }
        }

        @media(max-width:900px) and (orientation: landscape){
            .player-area{
                height:80vh !important;
                min-height:250px;
            }
            .sidebar{
                height:20vh !important;
                min-height:150px;
            }
            
            .header h1{
                font-size:1.1em;
            }
            
            .warning{
                font-size:0.7em;
            }
            
            .filter-btn {
                font-size: 0.7em;
                padding: 4px 6px;
            }
            
            .player-header h2{
                font-size:1em;
            }
        }
        
        .mobile-header-info {
            display:none;
        }
        
        @media(max-width:900px){
            .mobile-header-info {
                display:block;
                font-size:0.75em;
                color:#4ecdc4;
                margin-top:3px;
                text-align:center;
                font-style:italic;
            }
        }
    </style>
</head>
<body>

<div class="header">
    <div class="header-top">
        <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Visa eller dÃ¶lj kanallista">
            ðŸ“º <span class="sr-only">Visa kanaler</span>
        </button>
        <h1>XOM TV</h1>
        <div style="width:80px"></div>
    </div>
    <p>Alla iranska TV-kanaler â€“ fungerar perfekt</p>
    <div class="filter-buttons">
        <button class="filter-btn active" onclick="filterChannels('all')">Alla kanaler</button>
        <button class="filter-btn" onclick="filterChannels('national')">1. Nationella</button>
        <button class="filter-btn" onclick="filterChannels('regional')">2. Regionala</button>
        <button class="filter-btn" onclick="filterChannels('kurdish')">3. Kurdiska</button>
        <button class="filter-btn" onclick="filterChannels('karwan')">4. Karwan TV</button>
        <button class="filter-btn" onclick="filterChannels('web')">5. Webbplatser</button>
    </div>
    <p class="warning">KÃ¶r via lokal server â†’ python -m http.server</p>
    <p class="mobile-header-info">Klicka pÃ¥ "Visa kanaler" fÃ¶r att vÃ¤lja kanal</p>
</div>

<div class="container">
    <div class="player-area">
        <div class="player-header">
            <h2 id="channelName">TV1</h2>
            <div class="player-controls">
                <button class="pip-btn" onclick="togglePictureInPicture(event)" aria-label="Aktivera bild-i-bild">ðŸ“º PiP</button>
                <button class="pip-btn" onclick="toggleFullscreen()" aria-label="Visa i fullskÃ¤rm">â›¶ FullskÃ¤rm</button>
                <button class="pip-btn" onclick="reloadPlayer()" aria-label="Ladda om spelaren">â†» Ladda om</button>
                <button class="pip-btn" onclick="toggleUserAgentMode()" aria-label="VÃ¤xla User-Agent lÃ¤ge" id="userAgentBtn">ðŸ“± UA: Auto</button>
            </div>
        </div>
        <div class="player-container">
            <div class="loading-spinner" id="loadingSpinner"></div>
            <div class="error-overlay" id="errorOverlay">
                <div id="errorMessage">Kunde inte ladda stream</div>
                <button onclick="retryCurrentStream()">FÃ¶rsÃ¶k igen</button>
                <button onclick="tryAlternativeStream()" style="margin-top: 10px; background: #e67e22;">Testa alternativ stream</button>
            </div>
            <video id="videoPlayer" controls playsinline>
                Din webblÃ¤sare stÃ¶der inte videoavspelning.
            </video>
            <iframe
                id="iframePlayer"
                src="https://m.telewebion.com/embed/live/tv1?autoplay=1&mute=0"
                allowfullscreen
                allow="autoplay *; encrypted-media *; picture-in-picture *; fullscreen *"
                loading="eager"
                sandbox="allow-scripts allow-same-origin allow-presentation allow-popups"
                title="TV-spelare"
                referrerpolicy="no-referrer-when-downgrade">
            </iframe>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="section" id="favSection">
            <h3>Favoriter</h3>
            <div id="favoritesList" style="color:#fff">Inga favoriter</div>
        </div>

        <div class="section" id="nationalSection">
            <h3>Nationella Kanaler</h3>
            <div class="channel active" onclick="load('tv1','TV1',this)">
                <span class="label">TV1</span>
                <button class="fav" onclick="toggleFav(event,'tv1','TV1',this)" aria-label="LÃ¤gg till favorit">â˜†</button>
            </div>
            <div class="channel" onclick="load('tv2','TV2',this)"><span class="label">TV2</span><button class="fav" onclick="toggleFav(event,'tv2','TV2',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('tv3','TV3',this)"><span class="label">TV3</span><button class="fav" onclick="toggleFav(event,'tv3','TV3',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('tv4','TV4',this)"><span class="label">TV4</span><button class="fav" onclick="toggleFav(event,'tv4','TV4',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('Tehran','Tehran',this)"><span class="label">Tehran</span><button class="fav" onclick="toggleFav(event,'Tehran','Tehran',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('nasim','NASIM',this)"><span class="label">NASIM</span><button class="fav" onclick="toggleFav(event,'nasim','NASIM',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('varzesh','VARZESH',this)"><span class="label">VARZESH (Sport)</span><button class="fav" onclick="toggleFav(event,'varzesh','VARZESH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('irinn','IRINN / KHABAR',this)"><span class="label">IRINN / KHABAR</span><button class="fav" onclick="toggleFav(event,'irinn','IRINN / KHABAR',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('irinn2','KHABAR2',this)"><span class="label">KHABAR2</span><button class="fav" onclick="toggleFav(event,'irinn2','KHABAR2',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('ifilm','IFILM Farsi',this)"><span class="label">IFILM Farsi</span><button class="fav" onclick="toggleFav(event,'ifilm','IFILM Farsi',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('ifilmdari_hls','IFILM Dari (HLS)', 'https://live.presstv.ir/hls/ifilm2.m3u8', this)"><span class="label">IFILM Dari (HLS)</span><button class="fav" onclick="toggleFav(event,'ifilmdari_hls','IFILM Dari (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('ifilmen_hls','IFILM English (HLS)', 'https://live.presstv.ir/hls/ifilmen.m3u8', this)"><span class="label">IFILM English (HLS)</span><button class="fav" onclick="toggleFav(event,'ifilmen_hls','IFILM English (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('ifilmar_hls','IFILM Arabic (HLS)', 'https://live.presstv.ir/hls/ifilmar.m3u8', this)"><span class="label">IFILM Arabic (HLS)</span><button class="fav" onclick="toggleFav(event,'ifilmar_hls','IFILM Arabic (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('tv1plus','TV1PLUS',this)"><span class="label">TV1PLUS</span><button class="fav" onclick="toggleFav(event,'tv1plus','TV1PLUS',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('omid','OMID',this)"><span class="label">OMID</span><button class="fav" onclick="toggleFav(event,'omid','OMID',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('namayesh','NAMAYESH',this)"><span class="label">NAMAYESH</span><button class="fav" onclick="toggleFav(event,'namayesh','NAMAYESH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('mostanad','MOSTANAD',this)"><span class="label">MOSTANAD</span><button class="fav" onclick="toggleFav(event,'mostanad','MOSTANAD',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('hdtest','TAMASHA',this)"><span class="label">TAMASHA</span><button class="fav" onclick="toggleFav(event,'hdtest','TAMASHA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('amouzesh','AMOOZESH',this)"><span class="label">AMOOZESH</span><button class="fav" onclick="toggleFav(event,'amouzesh','AMOOZESH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('salamat','SALAMAT',this)"><span class="label">SALAMAT</span><button class="fav" onclick="toggleFav(event,'salamat','SALAMAT',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('ofogh','OFOGH',this)"><span class="label">OFOGH</span><button class="fav" onclick="toggleFav(event,'ofogh','OFOGH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('quran','QURAN TV',this)"><span class="label">QURAN TV</span><button class="fav" onclick="toggleFav(event,'quran','QURAN TV',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('pooya','POOYA & JAVANAN',this)"><span class="label">POOYA & JAVANAN</span><button class="fav" onclick="toggleFav(event,'pooya','POOYA & JAVANAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('javaneh','JAVANEH / KOODAK+',this)"><span class="label">JAVANEH / KOODAK+</span><button class="fav" onclick="toggleFav(event,'javaneh','JAVANEH / KOODAK+',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sepehr','SEPEHR',this)"><span class="label">SEPEHR</span><button class="fav" onclick="toggleFav(event,'sepehr','SEPEHR',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('faratar','FARATAR',this)"><span class="label">FARATAR</span><button class="fav" onclick="toggleFav(event,'faratar','FARATAR',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('nava','NAVA',this)"><span class="label">NAVA</span><button class="fav" onclick="toggleFav(event,'nava','NAVA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('nama','NAMA',this)"><span class="label">NAMA</span><button class="fav" onclick="toggleFav(event,'nama','NAMA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('iribu','ROYA',this)"><span class="label">ROYA</span><button class="fav" onclick="toggleFav(event,'iribu','ROYA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('ara','ARA',this)"><span class="label">ARA</span><button class="fav" onclick="toggleFav(event,'ara','ARA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('iraneman','IRANEMAN',this)"><span class="label">IRANEMAN</span><button class="fav" onclick="toggleFav(event,'iraneman','IRANEMAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('golkhane','GOLKHANE',this)"><span class="label">GOLKHANE</span><button class="fav" onclick="toggleFav(event,'golkhane','GOLKHANE',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('negarestan','NEGARESTAN',this)"><span class="label">NEGARESTAN</span><button class="fav" onclick="toggleFav(event,'negarestan','NEGARESTAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('karoon','KAROON',this)"><span class="label">KAROON</span><button class="fav" onclick="toggleFav(event,'karoon','KAROON',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sport3','TELEWEBION',this)"><span class="label">TELEWEBION</span><button class="fav" onclick="toggleFav(event,'sport3','TELEWEBION',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sport1','TELEWEBION1',this)"><span class="label">TELEWEBION1</span><button class="fav" onclick="toggleFav(event,'sport1','TELEWEBION1',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sport3','TELEWEBION2',this)"><span class="label">TELEWEBION2</span><button class="fav" onclick="toggleFav(event,'sport3','TELEWEBION2',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('parseh','PARSEH',this)"><span class="label">PARSEH</span><button class="fav" onclick="toggleFav(event,'parseh','PARSEH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('nesfejahan','NESFEJAHAN',this)"><span class="label">NESFEJAHAN</span><button class="fav" onclick="toggleFav(event,'nesfejahan','NESFEJAHAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sarbedaran','SARBEDARAN',this)"><span class="label">SARBEDARAN</span><button class="fav" onclick="toggleFav(event,'sarbedaran','SARBEDARAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
        </div>

        <div class="section" id="regionalSection">
            <h3>Regionala Kanaler</h3>
            <div class="channel" onclick="load('mahabad','MAHABAD',this)"><span class="label">MAHABAD</span><button class="fav" onclick="toggleFav(event,'mahabad','MAHABAD',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('kordestan','KORDESTAN',this)"><span class="label">KORDESTAN</span><button class="fav" onclick="toggleFav(event,'kordestan','KORDESTAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('zagros','KERMANSHAH',this)"><span class="label">KERMANSHAH</span><button class="fav" onclick="toggleFav(event,'zagros','KERMANSHAH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('ilam','ILAM',this)"><span class="label">ILAM</span><button class="fav" onclick="toggleFav(event,'ilam','ILAM',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('bushehr','BOOSHEHR',this)"><span class="label">BOOSHEHR</span><button class="fav" onclick="toggleFav(event,'bushehr','BOOSHEHR',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('abadan','ABADAN',this)"><span class="label">ABADAN</span><button class="fav" onclick="toggleFav(event,'abadan','ABADAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('khalijefars','BANDARABBAS',this)"><span class="label">BANDARABBAS</span><button class="fav" onclick="toggleFav(event,'khalijefars','BANDARABBAS',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('khoozestan','AHVAZ',this)"><span class="label">AHVAZ</span><button class="fav" onclick="toggleFav(event,'khoozestan','AHVAZ',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('kish','KISH',this)"><span class="label">KISH</span><button class="fav" onclick="toggleFav(event,'kish','KISH',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('hamoon','ZAHEDAN',this)"><span class="label">ZAHEDAN</span><button class="fav" onclick="toggleFav(event,'hamoon','ZAHEDAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('alborz','ALBORZ',this)"><span class="label">ALBORZ</span><button class="fav" onclick="toggleFav(event,'alborz','ALBORZ',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('aftab','ARAK',this)"><span class="label">ARAK</span><button class="fav" onclick="toggleFav(event,'aftab','ARAK',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('semnan','SEMNAN',this)"><span class="label">SEMNAN</span><button class="fav" onclick="toggleFav(event,'semnan','SEMNAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('noor','QOM',this)"><span class="label">QOM</span><button class="fav" onclick="toggleFav(event,'noor','QOM',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('qazvin','QAZVIN',this)"><span class="label">QAZVIN</span><button class="fav" onclick="toggleFav(event,'qazvin','QAZVIN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('jahanbin','4Mahalebakhtiari',this)"><span class="label">4Mahalebakhtiari</span><button class="fav" onclick="toggleFav(event,'jahanbin','4Mahalebakhtiari',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sina','HAMADAN',this)"><span class="label">HAMADAN</span><button class="fav" onclick="toggleFav(event,'sina','HAMADAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('aflak','LORESTAN',this)"><span class="label">LORESTAN</span><button class="fav" onclick="toggleFav(event,'aflak','LORESTAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('kerman','KERMAN',this)"><span class="label">KERMAN</span><button class="fav" onclick="toggleFav(event,'kerman','KERMAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('esfahan','ESFEHAN',this)"><span class="label">ESFEHAN</span><button class="fav" onclick="toggleFav(event,'esfahan','ESFEHAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('fars','FARS',this)"><span class="label">FARS</span><button class="fav" onclick="toggleFav(event,'fars','FARS',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('taban','YAZD',this)"><span class="label">YAZD</span><button class="fav" onclick="toggleFav(event,'taban','YAZD',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('dena','YASOOJ',this)"><span class="label">YASOOJ</span><button class="fav" onclick="toggleFav(event,'dena','YASOOJ',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('khavaran','KH.JONOBI',this)"><span class="label">KH.JONOBI</span><button class="fav" onclick="toggleFav(event,'khavaran','KH.JONOBI',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('atrak','KH.SHOMALI',this)"><span class="label">KK.SHOMALI</span><button class="fav" onclick="toggleFav(event,'atrak','KH.SHOMALI',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('khorasanrazavi','KH.RAZAVI',this)"><span class="label">KK.RAZAVI</span><button class="fav" onclick="toggleFav(event,'khorasanrazavi','KH.RAZAVI',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sabz','GORGAN',this)"><span class="label">GORGAN</span><button class="fav" onclick="toggleFav(event,'sabz','GORGAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('tabarestan','MAZANDARAN',this)"><span class="label">MAZANDARAN</span><button class="fav" onclick="toggleFav(event,'tabarestan','MAZANDARAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('baran','GILAN',this)"><span class="label">GILAN</span><button class="fav" onclick="toggleFav(event,'baran','GILAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sabalan','ARDABIL',this)"><span class="label">ARDABIL</span><button class="fav" onclick="toggleFav(event,'sabalan','ARDABIL',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('sahand','TABRIZ',this)"><span class="label">TABRIZ</span><button class="fav" onclick="toggleFav(event,'sahand','TABRIZ',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('azarbayjangharbi','URMIA',this)"><span class="label">URMIA</span><button class="fav" onclick="toggleFav(event,'azarbayjangharbi','URMIA',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel" onclick="load('eshragh','ZANJAN',this)"><span class="label">ZANJAN</span><button class="fav" onclick="toggleFav(event,'eshragh','ZANJAN',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
        </div>

        <!-- Kurdiska kanaler -->
        <div class="section" id="kurdishSection">
            <h3>Kurdiska Kanaler</h3>
            <div class="channel extra-link" onclick="loadHLS('zagros_hls','Zagros (HLS)', 'https://5a3ed7a72ed4b.streamlock.net/zagrostv/SMIL:myStream.smil/playlist.m3u8', this)"><span class="label">Zagros (HLS)</span><button class="fav" onclick="toggleFav(event,'zagros_hls','Zagros (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('kanal8_hls','Kanal8 (HLS)', 'https://live.channel8.com/Channel8-Kurdish/index.fmp4.m3u8', this)"><span class="label">Kanal8 (HLS)</span><button class="fav" onclick="toggleFav(event,'kanal8_hls','Kanal8 (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('rudaw_hls','Rudaw (HLS)', 'https://svs.itworkscdn.net/rudawlive/rudawlive.smil/playlist.m3u8', this)"><span class="label">Rudaw (HLS)</span><button class="fav" onclick="toggleFav(event,'rudaw_hls','Rudaw (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('kurdnews_hls','Kurdsat News (HLS)', 'https://hlspackager.akamaized.net/live/DB/KURDSAT_NEWS/HLS/KURDSAT_NEWS.m3u8', this)"><span class="label">Kurdsat News (HLS)</span><button class="fav" onclick="toggleFav(event,'kurdnews_hls','Kurdsat News (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('sterk_hls','Sterk (HLS)', 'https://5dab1db4b25fe.streamlock.net/sterk/sterktv/chunklist_w1084077249.m3u8', this)"><span class="label">Sterk (HLS)</span><button class="fav" onclick="toggleFav(event,'sterk_hls','Sterk (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('nrt_hls','NRT News (HLS)', 'https://media.streambrothers.com:1936/8226/8226/playlist.m3u8', this)"><span class="label">NRT News (HLS)</span><button class="fav" onclick="toggleFav(event,'nrt_hls','NRT News (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('4kurd_hls','4 Kurd (HLS)', 'https://4kuhls.persiana.live/hls/stream.m3u8', this)"><span class="label">4 Kurd (HLS)</span><button class="fav" onclick="toggleFav(event,'4kurd_hls','4 Kurd (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('medmusic_hls','Med Music (HLS)', 'http://54.36.110.140/live3/live3.m3u8', this)"><span class="label">Med Music (HLS)</span><button class="fav" onclick="toggleFav(event,'medmusic_hls','Med Music (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('aryen_hls','Aryen (HLS)', 'https://stream.aryen.tv/live/tv/chunklist_w189856026.m3u8', this)"><span class="label">Aryen (HLS)</span><button class="fav" onclick="toggleFav(event,'aryen_hls','Aryen (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('cira_hls','Cira (HLS)', 'https://cira-tv.akamaized.net/hls/stream_0.m3u8', this)"><span class="label">Cira (HLS)</span><button class="fav" onclick="toggleFav(event,'cira_hls','Cira (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('waar_hls','Waar (HLS)', 'https://live.kwikmotion.com/waarmedialive/waarmedia.smil/waarmediapublish/waarmedia_source/chunks.m3u8', this)"><span class="label">Waar (HLS)</span><button class="fav" onclick="toggleFav(event,'waar_hls','Waar (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('rojava_hls','Rojava (HLS)', 'https://rojava-tv.akamaized.net/hls/rojava-tv.m3u8', this)"><span class="label">Rojava (HLS)</span><button class="fav" onclick="toggleFav(event,'rojava_hls','Rojava (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('kurdhd_hls','Kurdsat HD (HLS)', 'https://hlspackager.akamaized.net/live/DB/KURDSAT_HD/HLS/KURDSAT_HD.m3u8', this)"><span class="label">Kurdsat HD (HLS)</span><button class="fav" onclick="toggleFav(event,'kurdhd_hls','Kurdsat HD (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('kurdistantv_hls','Kurdistan TV (HLS)', 'https://5a3ed7a72ed4b.streamlock.net/live/SMIL:myStream.smil/playlist.m3u8', this)"><span class="label">Kurdistan TV (HLS)</span><button class="fav" onclick="toggleFav(event,'kurdistantv_hls','Kurdistan TV (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('pdki_hls','PDKI (HLS)', 'https://cdn.northtelecom.org/KurdChannel.m3u8', this)"><span class="label">PDKI (HLS)</span><button class="fav" onclick="toggleFav(event,'pdki_hls','PDKI (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('komala_hls','Komala (HLS)', 'https://live.tvkomala.com/live/komala/playlist.m3u8', this)"><span class="label">Komala (HLS)</span><button class="fav" onclick="toggleFav(event,'komala_hls','Komala (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('gk_hls','GK (HLS)', 'https://live.host247.net/gk/gksat/playlist.m3u8', this)"><span class="label">GK (HLS)</span><button class="fav" onclick="toggleFav(event,'gk_hls','GK (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('iribkurd_hls','IRIB Kurdistan (HLS)', 'https://lenz.splus.ir/PLTV/88888888/224/3221226647/index.m3u8', this)"><span class="label">IRIB Kurdistan (HLS)</span><button class="fav" onclick="toggleFav(event,'iribkurd_hls','IRIB Kurdistan (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel web-link" onclick="openLink('https://kurdish.sahartv.ir/live')"><span class="label">Sahar TV (Web)</span><button class="fav" onclick="toggleFav(event,'sahar_web','Sahar TV (Web)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel web-link" onclick="openLink('https://www.ava.news/livewatch')"><span class="label">Ava TV (Web)</span><button class="fav" onclick="toggleFav(event,'ava_web','Ava TV (Web)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel web-link" onclick="openLink('https://utvhawler.net/index.htm')"><span class="label">UTV Hawler (Web)</span><button class="fav" onclick="toggleFav(event,'utv_web','UTV Hawler (Web)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('baxche_hls','Baxche (HLS)', 'https://5dcabf026b188.streamlock.net/afarinTV/livestream/playlist.m3u8', this)"><span class="label">Baxche (HLS)</span><button class="fav" onclick="toggleFav(event,'baxche_hls','Baxche (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('afarinkids_hls','Afarin Kids (HLS)', 'https://65f16f0fdfc51.streamlock.net/afarinTV/livestream/playlist.m3u8', this)"><span class="label">Afarin Kids (HLS)</span><button class="fav" onclick="toggleFav(event,'afarinkids_hls','Afarin Kids (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('zarokkurm_hls','Zarok Kurmanci (HLS)', 'https://zindikurmanci.zaroktv.com.tr/hls/0/stream.m3u8', this)"><span class="label">Zarok Kurmanci (HLS)</span><button class="fav" onclick="toggleFav(event,'zarokkurm_hls','Zarok Kurmanci (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
            <div class="channel extra-link" onclick="loadHLS('zaroksor_hls','Zarok Sorani (HLS)', 'https://zindisorani.zaroktv.com.tr/hls/stream.m3u8', this)"><span class="label">Zarok Sorani (HLS)</span><button class="fav" onclick="toggleFav(event,'zaroksor_hls','Zarok Sorani (HLS)',this)" aria-label="LÃ¤gg till favorit">â˜†</button></div>
        </div>

        <!-- Karwan TV -->
        <div class="section" id="karwanSection">
            <h3>Karwan TV</h3>
            <div class="channel karwan-link" onclick="openKarwan()">
                <span class="label">Karwan TV (Ã¶ppnas i nytt fÃ¶nster)</span>
            </div>
        </div>

        <!-- Webbplatser -->
        <div class="section" id="webLinksSection">
            <h3>Webbplatser</h3>
            <div class="channel extra-link" onclick="loadHLS('ifilm_extra2','IFILM Farsi (Alt 2)', 'https://live.presstv.ir/hls/ifilmfa_4_482/index.m3u8', this)">
                <span class="label">IFILM Farsi (Alt 2)</span>
                <button class="fav" onclick="toggleFav(event,'ifilm_extra2','IFILM Farsi (Alt 2)',this)" aria-label="LÃ¤gg till favorit">â˜†</button>
            </div>
            <div class="channel web-link" onclick="openLink('https://www.aparatchi.com/iran-live-tv')"><span class="label">Aparatchi - Iran Live TV</span></div>
            <div class="channel web-link" onclick="openLink('http://www.imvbox.tv/en')"><span class="label">IMVBox</span></div>
            <div class="channel web-link" onclick="openLink('https://www.giniko.com/watch.php?id=372')"><span class="label">Giniko TV</span></div>
            <div class="channel web-link" onclick="openLink('https://www.persianity.com/')"><span class="label">Persianity</span></div>
            <div class="channel web-link" onclick="openLink('https://www.parsatv.com/#irib')"><span class="label">Parsa TV</span></div>
            <div class="channel web-link" onclick="openLink('http://mdbmax.com')"><span class="label">MDB Max</span></div>
            <div class="channel web-link" onclick="openLink('https://farsiplex.com/')"><span class="label">FarsiPlex</span></div>
            <div class="channel web-link" onclick="openLink('https://flnd.buzz/')"><span class="label">Flnd Buzz</span></div>
            <div class="channel web-link" onclick="openLink('https://farsiland.com/iran-movie-2025/')"><span class="label">Farsiland Movies</span></div>
            <div class="channel web-link" onclick="openLink('https://persianhive.com/movies_films/')"><span class="label">Persian Hive</span></div>
            <div class="channel web-link" onclick="openLink('https://namakade.com/index.html?EcD6wOwBgwilFvmHXvTv')"><span class="label">Namakade</span></div>
            <div class="channel web-link" onclick="openLink('https://telewebion.com/')"><span class="label">Telewebion</span></div>
            <div class="channel web-link" onclick="openLink('https://sepehrtv.ir/')"><span class="label">Sepehr TV</span></div>
        </div>
    </div>
</div>

<script>
    let currentStream = null;
    let currentChannel = 'tv1';
    let currentTitle = 'TV1';
    let currentChannelEl = null;
    let hls = null;
    let userAgentMode = 'auto';
    let streamErrorCount = 0;
    const MAX_ERRORS = 3;
    
    // Telewebion kanaler
    const telewebionChannels = {
        'tv1': 'tv1',
        'tv2': 'tv2', 
        'tv3': 'tv3',
        'tv4': 'tv4',
        'Tehran': 'tvtehran',
        'nasim': 'nasim',
        'varzesh': 'varzesh',
        'irinn': 'irinn',
        'irinn2': 'khabar',
        'ifilm': 'ifilm',
        'ifilmdari': 'ifilm2',
        'ifilmen': 'ifilmen',
        'ifilmar': 'ifilmar',
        'tv1plus': 'tv1plus',
        'omid': 'omid',
        'namayesh': 'namayesh',
        'mostanad': 'mostanad',
        'hdtest': 'hdtest',
        'amouzesh': 'amouzesh',
        'salamat': 'salamat',
        'ofogh': 'ofogh',
        'quran': 'quran',
        'pooya': 'pooya',
        'javaneh': 'javaneh',
        'sepehr': 'sepehr',
        'faratar': 'faratar',
        'nava': 'nava',
        'nama': 'nama',
        'iribu': 'iribu',
        'ara': 'ara',
        'iraneman': 'iraneman',
        'golkhane': 'golkhane',
        'negarestan': 'negarestan',
        'karoon': 'karoon',
        'sport3': 'sport3',
        'sport1': 'sport1',
        'parseh': 'parseh',
        'nesfejahan': 'nesfejahan',
        'sarbedaran': 'sarbedaran',
        
        // Regionala kanaler
        'mahabad': 'mahabad',
        'kordestan': 'kordestan',
        'zagros': 'kermanshah',
        'ilam': 'ilam',
        'bushehr': 'booshehr',
        'abadan': 'abadan',
        'khalijefars': 'khalijefars',
        'khoozestan': 'ahvaz',
        'kish': 'kish',
        'hamoon': 'zahedan',
        'alborz': 'alborz',
        'aftab': 'arak',
        'semnan': 'semnan',
        'noor': 'qom',
        'qazvin': 'qazvin',
        'jahanbin': 'bakhtiari',
        'sina': 'hamedan',
        'aflak': 'lorestan',
        'kerman': 'kerman',
        'esfahan': 'esfahan',
        'fars': 'shiraz',
        'taban': 'yazd',
        'dena': 'kohgiluyeh',
        'khavaran': 'khorasanej',
        'atrak': 'khorasansh',
        'khorasanrazavi': 'khorasanr',
        'sabz': 'golestan',
        'tabarestan': 'mazandaran',
        'baran': 'gilan',
        'sabalan': 'ardabil',
        'sahand': 'tabriz',
        'azarbayjangharbi': 'urmia',
        'eshragh': 'zanjan',
        
        // Kurdiska kanaler
        'kurdish1': 'kurdish1',
        'kurdish2': 'kurdish2',
        'kurdish3': 'kurdish3',
        'kurdish4': 'kurdish4',
        'kurdish5': 'kurdish5'
    };

    // Favorites system
    let favorites = JSON.parse(localStorage.getItem('xomTvFavorites')) || [];
    
    function updateFavoritesList() {
        const favList = document.getElementById('favoritesList');
        if (favorites.length === 0) {
            favList.innerHTML = '<div style="color:#fff; padding:10px; text-align:center;">Inga favoriter</div>';
            return;
        }
        
        favList.innerHTML = '';
        favorites.forEach(fav => {
            const favItem = document.createElement('div');
            favItem.className = 'channel';
            favItem.innerHTML = `
                <span class="label">${fav.title}</span>
                <button class="fav fav-active" onclick="toggleFav(event,'${fav.id}','${fav.title}',this)" aria-label="Ta bort favorit">â˜…</button>
            `;
            
            // Set the onclick handler based on channel type
            if (fav.id === 'ifilm_extra2') {
                favItem.onclick = function() {
                    loadHLS(fav.id, fav.title, 'https://live.presstv.ir/hls/ifilmfa_4_482/index.m3u8', this);
                };
            } else {
                favItem.onclick = function() {
                    load(fav.id, fav.title, this);
                };
            }
            
            favList.appendChild(favItem);
        });
    }
    
    function toggleFav(event, id, title, button) {
        event.stopPropagation();
        
        const index = favorites.findIndex(fav => fav.id === id);
        if (index === -1) {
            favorites.push({id, title});
            button.classList.add('fav-active');
            button.innerHTML = 'â˜…';
            button.setAttribute('aria-label', 'Ta bort favorit');
        } else {
            favorites.splice(index, 1);
            button.classList.remove('fav-active');
            button.innerHTML = 'â˜†';
            button.setAttribute('aria-label', 'LÃ¤gg till favorit');
        }
        
        localStorage.setItem('xomTvFavorites', JSON.stringify(favorites));
        updateFavoritesList();
    }
    
    // Initialize favorites on page load
    document.addEventListener('DOMContentLoaded', function() {
        updateFavoritesList();
        
        // Update star buttons based on favorites
        document.querySelectorAll('.channel').forEach(ch => {
            const favBtn = ch.querySelector('.fav');
            if (favBtn) {
                const onclick = ch.getAttribute('onclick');
                let channelId = '';
                
                if (onclick) {
                    if (onclick.includes("load('")) {
                        const match = onclick.match(/load\('([^']+)'/);
                        if (match) channelId = match[1];
                    } else if (onclick.includes("loadHLS('")) {
                        const match = onclick.match(/loadHLS\('([^']+)'/);
                        if (match) channelId = match[1];
                    }
                }
                
                if (channelId && favorites.some(fav => fav.id === channelId)) {
                    favBtn.classList.add('fav-active');
                    favBtn.innerHTML = 'â˜…';
                }
            }
        });
        
        load('tv1', 'TV1', document.querySelector('.channel.active'));
    });

    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const isHidden = sidebar.style.display === 'none' || sidebar.style.display === '';
        sidebar.style.display = isHidden ? 'block' : 'none';
        
        if (window.innerWidth <= 900) {
            if (isHidden) {
                sidebar.style.display = 'block';
                document.querySelector('.menu-toggle').innerHTML = 'âœ• <span class="sr-only">DÃ¶lj kanaler</span>';
            } else {
                sidebar.style.display = 'none';
                document.querySelector('.menu-toggle').innerHTML = 'ðŸ“º <span class="sr-only">Visa kanaler</span>';
            }
        }
    }

    function filterChannels(filter) {
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        const sections = {
            'all': ['favSection', 'nationalSection', 'regionalSection', 'kurdishSection', 'karwanSection', 'webLinksSection'],
            'national': ['favSection', 'nationalSection'],
            'regional': ['favSection', 'regionalSection'],
            'kurdish': ['favSection', 'kurdishSection'],
            'karwan': ['favSection', 'karwanSection'],
            'web': ['favSection', 'webLinksSection']
        };
        
        document.querySelectorAll('.section').forEach(section => {
            section.classList.add('hidden');
        });
        
        sections[filter].forEach(sectionId => {
            const section = document.getElementById(sectionId);
            if (section) section.classList.remove('hidden');
        });
    }

    function getTelewebionUrl(channel) {
        const channelSlug = telewebionChannels[channel] || channel;
        const baseUrl = 'https://m.telewebion.com/embed/live/';
        
        let userAgentParam = '';
        if (userAgentMode === 'mobile') {
            userAgentParam = '&mobile=1';
        } else if (userAgentMode === 'desktop') {
            userAgentParam = '&desktop=1';
        }
        
        return `${baseUrl}${channelSlug}?autoplay=1&mute=0${userAgentParam}`;
    }

    function showLoading() {
        document.getElementById('loadingSpinner').classList.add('active');
    }

    function hideLoading() {
        document.getElementById('loadingSpinner').classList.remove('active');
    }

    function showError(message) {
        document.getElementById('errorMessage').textContent = message;
        document.getElementById('errorOverlay').classList.add('active');
        streamErrorCount++;
    }

    function hideError() {
        document.getElementById('errorOverlay').classList.remove('active');
        streamErrorCount = 0;
    }

    function load(channel, title, element) {
        if (element) {
            if (currentChannelEl) {
                currentChannelEl.classList.remove('active');
            }
            element.classList.add('active');
            currentChannelEl = element;
        }
        
        currentChannel = channel;
        currentTitle = title;
        document.getElementById('channelName').textContent = title;
        
        showLoading();
        hideError();
        
        const videoPlayer = document.getElementById('videoPlayer');
        const iframePlayer = document.getElementById('iframePlayer');
        
        videoPlayer.style.display = 'none';
        iframePlayer.style.display = 'block';
        
        if (hls) {
            hls.destroy();
            hls = null;
        }
        
        videoPlayer.pause();
        videoPlayer.src = '';
        
        const telewebionUrl = getTelewebionUrl(channel);
        iframePlayer.src = telewebionUrl;
        
        setTimeout(() => {
            hideLoading();
        }, 5000);
        
        // Auto-close sidebar on mobile
        if (window.innerWidth <= 900) {
            setTimeout(() => {
                const sidebar = document.getElementById('sidebar');
                sidebar.style.display = 'none';
                document.querySelector('.menu-toggle').innerHTML = 'ðŸ“º <span class="sr-only">Visa kanaler</span>';
            }, 300);
        }
    }

    function loadHLS(channel, title, streamUrl, element) {
        if (element) {
            if (currentChannelEl) {
                currentChannelEl.classList.remove('active');
            }
            element.classList.add('active');
            currentChannelEl = element;
        }
        
        currentChannel = channel;
        currentTitle = title;
        document.getElementById('channelName').textContent = title;
        
        showLoading();
        hideError();
        
        const videoPlayer = document.getElementById('videoPlayer');
        const iframePlayer = document.getElementById('iframePlayer');
        
        iframePlayer.style.display = 'none';
        iframePlayer.src = '';
        videoPlayer.style.display = 'block';
        
        if (hls) {
            hls.destroy();
            hls = null;
        }
        
        videoPlayer.pause();
        videoPlayer.src = '';
        
        if (Hls.isSupported()) {
            hls = new Hls({
                enableWorker: true,
                lowLatencyMode: true,
                backBufferLength: 90
            });
            
            hls.loadSource(streamUrl);
            hls.attachMedia(videoPlayer);
            
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                videoPlayer.play().catch(e => {
                    console.log('Autoplay prevented:', e);
                    showError('Autoplay blockerad. Klicka pÃ¥ play-knappen.');
                });
                hideLoading();
                streamErrorCount = 0;
            });
            
            hls.on(Hls.Events.ERROR, function(event, data) {
                console.error('HLS error:', data);
                if (data.fatal) {
                    switch(data.type) {
                        case Hls.ErrorTypes.NETWORK_ERROR:
                            showError('NÃ¤tverksfel. FÃ¶rsÃ¶ker ladda om...');
                            hls.startLoad();
                            break;
                        case Hls.ErrorTypes.MEDIA_ERROR:
                            showError('Media fel. FÃ¶rsÃ¶ker Ã¥terstÃ¤lla...');
                            hls.recoverMediaError();
                            break;
                        default:
                            showError('Kunde inte ladda stream.');
                            hls.destroy();
                            break;
                    }
                }
            });
        } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
            videoPlayer.src = streamUrl;
            videoPlayer.addEventListener('loadedmetadata', function() {
                videoPlayer.play().catch(e => {
                    console.log('Autoplay prevented:', e);
                    showError('Autoplay blockerad. Klicka pÃ¥ play-knappen.');
                });
                hideLoading();
                streamErrorCount = 0;
            });
            
            videoPlayer.addEventListener('error', function() {
                showError('Kunde inte ladda HLS stream');
                hideLoading();
            });
        } else {
            showError('Din webblÃ¤sare stÃ¶der inte HLS playback');
            hideLoading();
        }
        
        // Auto-close sidebar on mobile
        if (window.innerWidth <= 900) {
            setTimeout(() => {
                const sidebar = document.getElementById('sidebar');
                sidebar.style.display = 'none';
                document.querySelector('.menu-toggle').innerHTML = 'ðŸ“º <span class="sr-only">Visa kanaler</span>';
            }, 300);
        }
    }

    function openKarwan() {
        window.open('https://karwan.tv', '_blank');
    }

    function openLink(url) {
        window.open(url, '_blank');
    }

    function togglePictureInPicture(event) {
        event.stopPropagation();
        const videoPlayer = document.getElementById('videoPlayer');
        
        if (document.pictureInPictureElement) {
            document.exitPictureInPicture().catch(error => {
                console.error('Error exiting PiP:', error);
            });
        } else if (document.pictureInPictureEnabled && videoPlayer.src) {
            videoPlayer.requestPictureInPicture().catch(error => {
                console.error('Error entering PiP:', error);
                showError('Bild-i-bild stÃ¶ds inte fÃ¶r denna stream');
            });
        } else {
            showError('Bild-i-bild stÃ¶ds inte eller ingen video spelas');
        }
    }

    function toggleFullscreen() {
        const playerArea = document.querySelector('.player-area');
        
        if (!document.fullscreenElement) {
            if (playerArea.requestFullscreen) {
                playerArea.requestFullscreen();
            } else if (playerArea.webkitRequestFullscreen) {
                playerArea.webkitRequestFullscreen();
            } else if (playerArea.msRequestFullscreen) {
                playerArea.msRequestFullscreen();
            }
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }
    }

    function reloadPlayer() {
        if (currentChannel === 'ifilm_extra2') {
            loadHLS('ifilm_extra2', 'IFILM Farsi (Alt 2)', 'https://live.presstv.ir/hls/ifilmfa_4_482/index.m3u8', currentChannelEl);
        } else {
            load(currentChannel, currentTitle, currentChannelEl);
        }
    }

    function toggleUserAgentMode() {
        const modes = ['auto', 'mobile', 'desktop'];
        const modeNames = {auto: 'Auto', mobile: 'Mobil', desktop: 'Desktop'};
        const currentIndex = modes.indexOf(userAgentMode);
        userAgentMode = modes[(currentIndex + 1) % modes.length];
        
        document.getElementById('userAgentBtn').textContent = `ðŸ“± UA: ${modeNames[userAgentMode]}`;
        
        if (telewebionChannels[currentChannel]) {
            load(currentChannel, currentTitle, currentChannelEl);
        }
    }

    function retryCurrentStream() {
        hideError();
        reloadPlayer();
    }

    function tryAlternativeStream() {
        hideError();
        reloadPlayer();
    }

    // Auto-hide sidebar when clicking a channel on mobile
    document.querySelectorAll('.channel').forEach(channel => {
        channel.addEventListener('click', function() {
            if (window.innerWidth <= 900) {
                const sidebar = document.getElementById('sidebar');
                sidebar.style.display = 'none';
                document.querySelector('.menu-toggle').innerHTML = 'ðŸ“º <span class="sr-only">Visa kanaler</span>';
            }
        });
    });

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function(event) {
        if (window.innerWidth <= 900) {
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.querySelector('.menu-toggle');
            
            if (sidebar.style.display === 'block' && 
                !sidebar.contains(event.target) && 
                !menuToggle.contains(event.target)) {
                sidebar.style.display = 'none';
                menuToggle.innerHTML = 'ðŸ“º <span class="sr-only">Visa kanaler</span>';
            }
        }
    });
</script>

</body>
</html>
